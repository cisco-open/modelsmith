"use strict";(self.webpackChunkmodelsmith=self.webpackChunkmodelsmith||[]).push([[481],{8481:(yt,J,s)=>{s.r(J),s.d(J,{ModelCompressionModule:()=>Ft});var d=s(6814),C=s(5154),c=s(4221),h=s(538);const z={models:(0,c.Lq)({models:[],error:void 0},(0,c.on)(h.l.loadModelsSuccess,(o,{models:e})=>({...o,models:[...e],error:void 0})),(0,c.on)(h.l.loadModelsFailure,(o,{error:e})=>({...o,error:e})))};var b=s(2096),D=s(2460),O=s(2181),$=s(4664),P=s(7398),V=s(6306),K=s(395),H=s(4992);class W extends H.eW{constructor(){super("model-files",void 0,void 0,!1)}}const X=(0,c.ZF)("model-compression"),R=(0,c.P1)(X,o=>o.models.models);var t=s(5879);let k=(()=>{var o;class e{constructor(n,l,m){this.apiClient=n,this.actions$=l,this.store=m,this.loadModels$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(h.l.loadModels),(0,D.M)(this.store.select(R)),(0,O.h)(([u,y])=>!y||0===y.length),(0,$.w)(()=>this.apiClient.serviceCall(new W).pipe((0,P.U)(u=>h.l.loadModelsSuccess({models:u})),(0,V.K)(u=>(0,b.of)(h.l.loadModelsFailure({error:u})))))))}}return(o=e).\u0275fac=function(n){return new(n||o)(t.LFG(K.I),t.LFG(C.eX),t.LFG(c.yh))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),e})();var w=s(3670),M=s(1303),N=s(7582),r=s(8791),q=s(3620),_=s(3997),tt=s(9386),G=s(4279),et=s(9547);const v="custommodel";var S=s(7820),A=s(127),Z=s(8471),a=s(6223),U=s(999),it=s(1146),st=s(8450),nt=s(6349),at=s(9534),rt=s(2296),lt=s(7921);let x=(()=>{var o;class e{constructor(n){this.store=n,this.models$=this.store.select(R)}dispatch(n){this.store.dispatch(n)}}return(o=e).\u0275fac=function(n){return new(n||o)(t.LFG(c.yh))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),e})();var p,E=s(5195),Y=s(5683),B=s(8525),T=s(3680),ct=s(3427);function mt(o,e){if(1&o&&(t.TgZ(0,"mat-option",11),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.Q6J("value",i),t.xp6(1),t.hij(" ",i," ")}}function dt(o,e){1&o&&(t.TgZ(0,"mat-option",12),t._uU(1,"No results found"),t.qZA())}function ht(o,e){if(1&o&&(t.ynx(0),t.YNc(1,mt,2,2,"mat-option",9),t.YNc(2,dt,2,0,"mat-option",10),t.BQk()),2&o){const i=e.ngIf,n=t.oxw();t.xp6(1),t.Q6J("ngForOf",i)("ngForTrackBy",n.trackByModel),t.xp6(1),t.Q6J("ngIf",0===i.length)}}let L=((p=class{get modelControl(){return this.form.get(this.MODEL_CONTROL_NAME)}constructor(e,i,n,l,m){this.fb=e,this.controlContainer=i,this.fileService=n,this.modelsFacadeService=l,this.scriptFacadeService=m,this.isCustomModelSelected=!1,this.searchModel=new a.NI,this.models=[],this.customModel=v,this.MODEL_CONTROL_NAME="model"}ngOnInit(){this.initializeForm(),this.loadModelsAndListenToChanges(),this.listenToModelChanges(),this.listenToScriptStateChanges(),this.filteredModels=this.searchModel.valueChanges.pipe((0,lt.O)(""),(0,P.U)(e=>this.filterModels(e)))}loadModelsAndListenToChanges(){this.modelsFacadeService.dispatch(h.l.loadModels()),this.modelsFacadeService.models$.pipe((0,r.t)(this)).subscribe(e=>{e?.length&&(this.models=e,this.searchModel.setValue(""))})}initializeForm(){this.form=this.fb.group({[this.MODEL_CONTROL_NAME]:new a.NI("",a.kI.required)}),this.controlContainer?.control?.parent?.setControl(this.controlContainer.name,this.form)}listenToModelChanges(){this.modelControl?.valueChanges.pipe((0,r.t)(this)).subscribe(e=>{e===v?(this.fileService.file=null,this.isCustomModelSelected=!0):this.isCustomModelSelected=!1})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe((0,r.t)(this)).subscribe(e=>{(0,A.A)(e)?this.form.disable():this.form.enable(),this.modelControl?.patchValue("resnet18")})}filterModels(e){const i=e.toLowerCase();return this.models.filter(n=>n.toLowerCase().includes(i))}trackByModel(e,i){return i}}).\u0275fac=function(e){return new(e||p)(t.Y36(a.qu),t.Y36(a.gN),t.Y36(U.I),t.Y36(x),t.Y36(Z.O))},p.\u0275cmp=t.Xpm({type:p,selectors:[["ms-panel-model"]],decls:12,vars:5,consts:[[1,"ms-card","model-card"],[1,"heading-sub-section-title"],[3,"formGroup"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","model","placeholder","Select a model..."],["label","Predefined Models"],[3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["disabled","",4,"ngIf"],[3,"value"],["disabled",""]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0)(1,"p",1),t._uU(2,"Model"),t.qZA(),t.ynx(3,2),t.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-optgroup",6)(8,"mat-option"),t._UZ(9,"ngx-mat-select-search",7),t.qZA(),t.YNc(10,ht,3,3,"ng-container",8),t.ALo(11,"async"),t.qZA()()()(),t.BQk(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("formGroup",i.form),t.xp6(6),t.Q6J("formControl",i.searchModel),t.xp6(1),t.Q6J("ngIf",t.lcZ(11,3,i.filteredModels)))},dependencies:[d.sg,d.O5,E.a8,Y.KE,B.gD,T.ey,T.Nv,a.JJ,a.JL,a.oH,a.sg,a.u,ct.nu,d.Ov],changeDetection:0}),p);L=(0,N.gn)([(0,r.c)()],L);var g,pt=s(836),gt=s(8180),ft=s(39),F=s(8279);function ut(o,e){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.Q6J("value",i.key),t.xp6(1),t.hij(" ",i.value," ")}}function vt(o,e){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.Q6J("value",i.key),t.xp6(1),t.hij(" ",i.value," ")}}let Q=((g=class{get algorithmFormControl(){return this.form.get(this.ALGORITHM_CONTROL_NAME)}constructor(e,i,n){this.fb=e,this.controlContainer=i,this.scriptFacadeService=n,this.pruningAlgorithmsList=F.dD,this.quantAlgorithmsList=F.A3,this.ALGORITHM_CONTROL_NAME="alg"}ngOnInit(){this.initForm(),this.listenToScriptStateChanges(),this.loadInitialData()}loadInitialData(){this.scriptFacadeService.dispatch(ft.aj.getCurrentOrLastActiveScriptDetails()),this.scriptFacadeService.scriptDetails$.pipe((0,pt.T)(1),(0,gt.q)(1),(0,O.h)(e=>!!e?.algKey)).subscribe(e=>{const i=e.type;this.setInitialAlgorithmValue(i===S.Bd.PRUNING||i===S.Bd.QUANTIZATION?e.algKey:F.k2)})}setInitialAlgorithmValue(e){this.algorithmFormControl?.setValue(e,{emitEvent:!0})}initForm(){this.form=this.fb.group({[this.ALGORITHM_CONTROL_NAME]:[F.k2,a.kI.required]}),this.controlContainer?.control?.parent?.setControl(this.controlContainer.name,this.form)}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe((0,r.t)(this)).subscribe(e=>{(0,A.A)(e)?this.form.disable():this.form.enable()})}trackByAlgorithmKey(e,i){return i.key}}).\u0275fac=function(e){return new(e||g)(t.Y36(a.qu),t.Y36(a.gN),t.Y36(Z.O))},g.\u0275cmp=t.Xpm({type:g,selectors:[["ms-panel-algorithm"]],decls:11,vars:6,consts:[[1,"ms-card","algorithm-card"],[1,"heading-sub-section-title"],[3,"formGroup"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],[3,"formControlName"],["label","Pruning"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["label","Quantization"],[3,"value"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0)(1,"p",1),t._uU(2,"Algorithm"),t.qZA(),t.ynx(3,2),t.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-optgroup",6),t.YNc(8,ut,2,2,"mat-option",7),t.qZA(),t.TgZ(9,"mat-optgroup",8),t.YNc(10,vt,2,2,"mat-option",7),t.qZA()()()(),t.BQk(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("formGroup",i.form),t.xp6(3),t.Q6J("formControlName",i.ALGORITHM_CONTROL_NAME),t.xp6(2),t.Q6J("ngForOf",i.pruningAlgorithmsList)("ngForTrackBy",i.trackByAlgorithmKey),t.xp6(2),t.Q6J("ngForOf",i.quantAlgorithmsList)("ngForTrackBy",i.trackByAlgorithmKey))},dependencies:[d.sg,E.a8,Y.KE,B.gD,T.ey,T.Nv,a.JJ,a.JL,a.sg,a.u]}),g);var f;Q=(0,N.gn)([(0,r.c)()],Q);const Ct=["panelParameters"],Mt=["algorithmPanel"];function St(o,e){1&o&&(t.ynx(0),t._UZ(1,"ms-panel-model",12),t.BQk())}let I=((f=class{constructor(e,i,n,l,m,u,y){this.scriptFacadeService=e,this.fb=i,this.fileService=n,this.fileFacadeService=l,this.snackbarService=m,this.router=u,this.route=y,this.isScriptActive=!1,this.isQuantAlgorithmSelected=!1}ngOnInit(){this.initForm(),this.listenToScriptStateChanges(),this.listenToAlgorithmPanelChanges()}listenToAlgorithmPanelChanges(){this.form.valueChanges.pipe((0,q.b)(50),(0,P.U)(e=>e.algorithm&&e.algorithm.alg),(0,_.x)(),(0,O.h)(e=>!!e),(0,r.t)(this)).subscribe(e=>{this.isQuantAlgorithmSelected=(0,S.t6)(e)===S.Bd.QUANTIZATION})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe((0,r.t)(this)).subscribe(e=>{this.isScriptActive=(0,A.A)(e),(0,A.A)(e)?this.form.disable():this.form.enable()})}initForm(){this.form=this.fb.group({algorithm:[],model:[],params:[]})}submit(){this.isQuantAlgorithmSelected?this.handleQuantizationCase():this.handlePruningCase()}handleQuantizationCase(){const{algorithm:e,model:i}=this.form.getRawValue(),{model:n}=i;if(n===v&&!this.fileService.isFileLoaded)return void this.snackbarService.showError("Please select a predefined model or upload a custom file.");let l=n===v?function ot(o){let e=o.replace(/[^a-zA-Z0-9_]/g,"_");return/^[0-9_]/.test(e)&&(e="file_"+e),/.py$/.test(e)||(e+=".py"),e}(this.fileService?.file.name):n;const m={...e,params:{...this.panelParametersComponent.parametersFormatted,arch:l}};n===v?this.fileFacadeService.dispatch(tt._.uploadFileAndCallScript({file:this.fileService.file,configs:m})):this.scriptFacadeService.dispatch(G.a.callScript({configs:m}))}handlePruningCase(){const{algorithm:e}=this.form.getRawValue(),i={...e,params:this.panelParametersComponent.parametersFormatted};this.scriptFacadeService.dispatch(G.a.callScript({configs:i}))}goToChartPage(){this.router.navigate([et.Z.RUNNING.ROOT])}}).\u0275fac=function(e){return new(e||f)(t.Y36(Z.O),t.Y36(a.qu),t.Y36(U.I),t.Y36(it.h),t.Y36(st.QD),t.Y36(M.F0),t.Y36(M.gz))},f.\u0275cmp=t.Xpm({type:f,selectors:[["ms-machine-unlearning"]],viewQuery:function(e,i){if(1&e&&(t.Gf(Ct,5),t.Gf(Mt,5)),2&e){let n;t.iGM(n=t.CRH())&&(i.panelParametersComponent=n.first),t.iGM(n=t.CRH())&&(i.algorithmParametersComponent=n.first)}},decls:17,vars:4,consts:[[1,"heading-primary-title","title"],[1,"project-settings-wrapper",3,"formGroup"],[1,"left"],[3,"formGroup"],["formGroupName","algorithm"],["panelAlgorithm",""],[4,"ngIf"],["formArrayName","params"],["panelParameters",""],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-raised-button","","color","primary",1,"ml-2",3,"click"],[1,"right"],["formGroupName","model"]],template:function(e,i){1&e&&(t.TgZ(0,"p",0),t._uU(1,"Project Settings"),t.qZA(),t.TgZ(2,"div",1)(3,"div",2),t.ynx(4,3),t._UZ(5,"ms-panel-algorithm",4,5),t.YNc(7,St,2,0,"ng-container",6),t._UZ(8,"ms-panel-parameters",7,8),t.BQk(),t.TgZ(10,"div")(11,"button",9),t.NdJ("click",function(){return i.submit()}),t._uU(12," Run "),t.qZA(),t.TgZ(13,"button",10),t.NdJ("click",function(){return i.goToChartPage()}),t._uU(14,"View Chart"),t.qZA()()(),t.TgZ(15,"div",11),t._UZ(16,"ms-terminal"),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(3),t.Q6J("ngIf",i.isQuantAlgorithmSelected),t.xp6(4),t.Q6J("disabled",i.isScriptActive||i.form.invalid))},dependencies:[d.O5,nt.d,at.w,rt.lW,a.JL,a.sg,a.x0,a.CE,L,Q],styles:[".title[_ngcontent-%COMP%]{margin-bottom:13px}.project-settings-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px;height:100%}.project-settings-wrapper[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:45%;gap:20px}.project-settings-wrapper[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:55%}"]}),f);I=(0,N.gn)([(0,r.c)()],I);const At=[{path:"",component:I}];let Tt=(()=>{var o;class e{}return(o=e).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[M.Bz.forChild(At),M.Bz]}),e})(),Ft=(()=>{var o;class e{}return(o=e).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[x],imports:[d.ez,w.m,Tt,c.Aw.forFeature("model-compression",z),C.sQ.forFeature([k])]}),e})()}}]);