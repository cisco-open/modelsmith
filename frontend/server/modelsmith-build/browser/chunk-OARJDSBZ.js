import{a as te}from"./chunk-QDCMNVIX.js";import{a as ae,b as se,c as ee}from"./chunk-YRSJWEPX.js";import{c as $,f as K,g as W}from"./chunk-XX6ZYDLH.js";import{a as G,b as J}from"./chunk-4HSOKWHU.js";import{a as X,d as Y}from"./chunk-47NJWMMS.js";import{n as Z}from"./chunk-7Q6ZV4YJ.js";import"./chunk-NCOEO6LZ.js";import{a as j,d as Q,h as N,j as U,k as q}from"./chunk-3DEWYFT2.js";import{Aa as l,B as T,Ec as v,H as y,La as w,Na as M,Ta as b,Xa as o,Xb as H,Xd as E,Ya as n,Za as m,ae as I,bb as u,ca as C,e as g,eb as p,ee as k,gb as _,ie as O,ka as c,la as d,lb as D,mb as x,nb as F,pb as f,pe as V,qe as z,sa as S,te as B,ue as R,we as L,xb as A,xe as P,za as h}from"./chunk-ED6LLMLR.js";var ie=g(ae()),re=g(se());var le=["terminalHistory"];function me(a,r){if(a&1){let oe=u();o(0,"mat-icon",16),p("click",function(){c(oe);let t=_();return d(t.disposeSearch())}),f(1," close "),n()}}function ce(a,r){a&1&&(o(0,"mat-icon",8),f(1,"search"),n())}var Ee=(()=>{let r=class r{constructor(e,t,i,s){this.destroyRef=e,this.dialogConfig=t,this.terminalFacadeService=i,this.terminalStylesService=s,this.searchFormControl=new k(""),this.fitAddon=new ie.FitAddon,this.searchAddon=new re.SearchAddon}ngOnInit(){this.initializeTerminal(),this.loadData(),this.listenToSearchFormControlChanges(),K()}ngAfterViewInit(){this.adjustHeightToParent(),this.fitTerminalToContainer()}loadData(){this.terminalFacadeService.dispatch(te.getTerminalHistory()),this.terminalFacadeService.terminalHistory.pipe(v(this.destroyRef)).subscribe(e=>{e&&this.writeToTerminal(e)})}initializeTerminal(){this.terminal=this.terminalStylesService.createTerminalInstance({cursorBlink:!1,disableStdin:!0}),this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(this.searchAddon),this.terminal.open(this.terminalHistoryDiv.nativeElement),this.setupResizeObserver()}listenToSearchFormControlChanges(){this.searchFormControl.valueChanges.pipe(v(this.destroyRef),y(300),T(e=>!$(e))).subscribe(e=>{this.search(e)})}search(e){this.searchAddon.findNext(e,{decorations:this.terminalStylesService.getSearchDecorationOptions()})}disposeSearch(){this.searchAddon.clearDecorations(),this.searchFormControl.setValue("")}writeToTerminal(e){let t=this.filterClearCommand(e);this.terminal.write(t)}filterClearCommand(e){let t=/\x1B\[H\x1B\[J/g;return e.replace(t,"")}setupResizeObserver(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(()=>this.fitTerminalToContainer()),this.resizeObserver.observe(this.terminalHistoryDiv.nativeElement)}fitTerminalToContainer(){this.fitAddon.fit()}adjustHeightToParent(){let e=this.terminalHistoryDiv.nativeElement.parentElement.parentElement.parentElement.parentElement;if(e){let t;t=e.offsetHeight-280,this.terminalHistoryDiv.nativeElement.style.height=`${t}px`}}scrollToTopTerminal(){this.terminal.scrollToTop()}scrollToBottomTerminal(){this.terminal.scrollToBottom()}ngOnDestroy(){this.resizeObserver?.disconnect(),W()}};r.\u0275fac=function(t){return new(t||r)(l(S),l(X),l(Z),l(ee))},r.\u0275cmp=C({type:r,selectors:[["ms-terminal-messages-history-dialog"]],viewQuery:function(t,i){if(t&1&&D(le,7),t&2){let s;x(s=F())&&(i.terminalHistoryDiv=s.first)}},standalone:!0,features:[A],decls:19,vars:2,consts:[["terminalHistory",""],[1,"ms-terminal-wrapper"],[1,"top-terminal-section"],[1,"left"],[1,"form-field-container"],["subscriptSizing","dynamic"],["matInput","","placeholder","Search terminal messages",3,"formControl"],["matSuffix","",1,"mat-error","scale-on-hover"],["matSuffix","",1,"mat-primary"],[1,"right"],["mat-icon-button","","color","primary","matTooltip","Scroll to top",3,"click"],["fontSet","ms","fontIcon","icon-ArrowUp"],["mat-icon-button","","color","primary","matTooltip","Scroll to bottom",3,"click"],["fontSet","ms","fontIcon","icon-ArrowDown"],[1,"terminal"],[1,"terminal-wrapper"],["matSuffix","",1,"mat-error","scale-on-hover",3,"click"]],template:function(t,i){if(t&1){let s=u();o(0,"ms-dialog")(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-label"),f(6,"Search"),n(),o(7,"mat-form-field",5),m(8,"input",6),w(9,me,2,0,"mat-icon",7)(10,ce,2,0,"mat-icon",8),n()()(),o(11,"div",9)(12,"button",10),p("click",function(){return c(s),d(i.scrollToTopTerminal())}),m(13,"mat-icon",11),n(),o(14,"button",12),p("click",function(){return c(s),d(i.scrollToBottomTerminal())}),m(15,"mat-icon",13),n()()(),o(16,"div",14),m(17,"div",15,0),n()()()}t&2&&(h(8),M("formControl",i.searchFormControl),h(),b(i.searchFormControl.value?9:10))},dependencies:[H,Y,P,L,R,B,V,E,I,z,O,q,U,N,j,Q,J,G],styles:[`.ms-terminal-wrapper{overflow-x:auto}.ms-terminal-wrapper .terminal-wrapper{border:10px solid var(--terminal-color);background-color:var(--terminal-color);border-radius:10px}.ms-terminal-wrapper .xterm-viewport{overflow-y:auto!important}.ms-terminal-wrapper .top-terminal-section{display:flex;justify-content:space-between;margin-bottom:10px}.ms-terminal-wrapper .top-terminal-section .right{display:flex;align-items:flex-end}
`],encapsulation:2});let a=r;return a})();export{Ee as MsTerminalMessagesHistoryDialogComponent};
