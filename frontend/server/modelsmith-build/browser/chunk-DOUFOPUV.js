import{a as A,b as O,d as k}from"./chunk-KEE6Z3KT.js";var E=k((L,T)=>{"use strict";(function(y,m){typeof L=="object"&&typeof T=="object"?T.exports=m():typeof define=="function"&&define.amd?define([],m):typeof L=="object"?L.SearchAddon=m():y.SearchAddon=m()})(self,()=>(()=>{"use strict";var y={345:(p,l)=>{Object.defineProperty(l,"__esModule",{value:!0}),l.runAndSubscribe=l.forwardEvent=l.EventEmitter=void 0,l.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=c=>(this._listeners.push(c),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===c)return void this._listeners.splice(h,1)}}})),this._event}fire(c,h){let u=[];for(let v=0;v<this._listeners.length;v++)u.push(this._listeners[v]);for(let v=0;v<u.length;v++)u[v].call(void 0,c,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},l.forwardEvent=function(c,h){return c(u=>h.fire(u))},l.runAndSubscribe=function(c,h){return h(void 0),c(u=>h(u))}},859:(p,l)=>{function c(h){for(let u of h)u.dispose();h.length=0}Object.defineProperty(l,"__esModule",{value:!0}),l.getDisposeArrayDisposable=l.disposeArray=l.toDisposable=l.MutableDisposable=l.Disposable=void 0,l.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){let u=this._disposables.indexOf(h);u!==-1&&this._disposables.splice(u,1)}},l.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){this._isDisposed||h===this._value||(this._value?.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},l.toDisposable=function(h){return{dispose:h}},l.disposeArray=c,l.getDisposeArrayDisposable=function(h){return{dispose:()=>c(h)}}}},m={};function R(p){var l=m[p];if(l!==void 0)return l.exports;var c=m[p]={exports:{}};return y[p](c,c.exports,R),c.exports}var x={};return(()=>{var p=x;Object.defineProperty(p,"__esModule",{value:!0}),p.SearchAddon=void 0;let l=R(345),c=R(859),h=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class u extends c.Disposable{constructor(e){super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new c.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new c.MutableDisposable,this._onDidChangeResults=this.register(new l.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=e?.highlightLimit??1e3}activate(e){this._terminal=e,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,c.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&this._lastSearchOptions?.decorations&&(this._highlightTimeout=setTimeout(()=>{let e=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(e,O(A({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(e){this._selectedDecoration.clear(),(0,c.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),e||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let s=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,t);this._lastSearchOptions=t,t?.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||s)&&this._highlightAllMatches(e,t);let i=this._findNextAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,i}_highlightAllMatches(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return void this.clearDecorations();t=t||{},this.clearDecorations(!0);let s=[],i,o=this._find(e,0,0,t);for(;o&&(i?.row!==o.row||i?.col!==o.col)&&!(s.length>=this._highlightLimit);)i=o,s.push(i),o=this._find(e,i.col+i.term.length>=this._terminal.cols?i.row+1:i.row,i.col+i.term.length>=this._terminal.cols?0:i.col+1,t);for(let r of s){let n=this._createResultDecoration(r,t.decorations);n&&(this._highlightedLines.add(n.marker.line),this._highlightDecorations.push({decoration:n,match:r,dispose(){n.dispose()}}))}}_find(e,t,s,i){if(!this._terminal||!e||e.length===0)return this._terminal?.clearSelection(),void this.clearDecorations();if(s>this._terminal.cols)throw new Error(`Invalid col: ${s} to search in terminal of ${this._terminal.cols} cols`);let o;this._initLinesCache();let r={startRow:t,startCol:s};if(o=this._findInLine(e,r,i),!o)for(let n=t+1;n<this._terminal.buffer.active.baseY+this._terminal.rows&&(r.startRow=n,r.startCol=0,o=this._findInLine(e,r,i),!o);n++);return o}_findNextAndSelect(e,t){if(!this._terminal||!e||e.length===0)return this._terminal?.clearSelection(),this.clearDecorations(),!1;let s=this._terminal.getSelectionPosition();this._terminal.clearSelection();let i=0,o=0;s&&(this._cachedSearchTerm===e?(i=s.end.x,o=s.end.y):(i=s.start.x,o=s.start.y)),this._initLinesCache();let r={startRow:o,startCol:i},n=this._findInLine(e,r,t);if(!n)for(let a=o+1;a<this._terminal.buffer.active.baseY+this._terminal.rows&&(r.startRow=a,r.startCol=0,n=this._findInLine(e,r,t),!n);a++);if(!n&&o!==0)for(let a=0;a<o&&(r.startRow=a,r.startCol=0,n=this._findInLine(e,r,t),!n);a++);return!n&&s&&(r.startRow=s.start.y,r.startCol=0,n=this._findInLine(e,r,t)),this._selectResult(n,t?.decorations,t?.noScroll)}findPrevious(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let s=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,t);this._lastSearchOptions=t,t?.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||s)&&this._highlightAllMatches(e,t);let i=this._findPreviousAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,i}_didOptionsChange(e,t){return!!t&&(e.caseSensitive!==t.caseSensitive||e.regex!==t.regex||e.wholeWord!==t.wholeWord)}_fireResults(e){if(e?.decorations){let t=-1;if(this._selectedDecoration.value){let s=this._selectedDecoration.value.match;for(let i=0;i<this._highlightDecorations.length;i++){let o=this._highlightDecorations[i].match;if(o.row===s.row&&o.col===s.col&&o.size===s.size){t=i;break}}}this._onDidChangeResults.fire({resultIndex:t,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!e||e.length===0)return this._terminal?.clearSelection(),this.clearDecorations(),!1;let s=this._terminal.getSelectionPosition();this._terminal.clearSelection();let i=this._terminal.buffer.active.baseY+this._terminal.rows-1,o=this._terminal.cols,r=!0;this._initLinesCache();let n={startRow:i,startCol:o},a;if(s&&(n.startRow=i=s.start.y,n.startCol=o=s.start.x,this._cachedSearchTerm!==e&&(a=this._findInLine(e,n,t,!1),a||(n.startRow=i=s.end.y,n.startCol=o=s.end.x))),a||(a=this._findInLine(e,n,t,r)),!a){n.startCol=Math.max(n.startCol,this._terminal.cols);for(let d=i-1;d>=0&&(n.startRow=d,a=this._findInLine(e,n,t,r),!a);d--);}if(!a&&i!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let d=this._terminal.buffer.active.baseY+this._terminal.rows-1;d>=i&&(n.startRow=d,a=this._findInLine(e,n,t,r),!a);d--);return this._selectResult(a,t?.decorations,t?.noScroll)}_initLinesCache(){let e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._linesCacheDisposables.value=(0,c.getDisposeArrayDisposable)([e.onLineFeed(()=>this._destroyLinesCache()),e.onCursorMove(()=>this._destroyLinesCache()),e.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,t,s){return(e===0||h.includes(t[e-1]))&&(e+s.length===t.length||h.includes(t[e+s.length]))}_findInLine(e,t,s={},i=!1){let o=this._terminal,r=t.startRow,n=t.startCol;if(o.buffer.active.getLine(r)?.isWrapped)return i?void(t.startCol+=o.cols):(t.startRow--,t.startCol+=o.cols,this._findInLine(e,t,s));let d=this._linesCache?.[r];d||(d=this._translateBufferLineToStringWithWrap(r,!0),this._linesCache&&(this._linesCache[r]=d));let[b,w]=d,C=this._bufferColsToStringOffset(r,n),D=s.caseSensitive?e:e.toLowerCase(),S=s.caseSensitive?b:b.toLowerCase(),g=-1;if(s.regex){let f=RegExp(D,"g"),_;if(i)for(;_=f.exec(S.slice(0,C));)g=f.lastIndex-_[0].length,e=_[0],f.lastIndex-=e.length-1;else _=f.exec(S.slice(C)),_&&_[0].length>0&&(g=C+(f.lastIndex-_[0].length),e=_[0])}else i?C-D.length>=0&&(g=S.lastIndexOf(D,C-D.length)):g=S.indexOf(D,C);if(g>=0){if(s.wholeWord&&!this._isWholeWord(g,S,e))return;let f=0;for(;f<w.length-1&&g>=w[f+1];)f++;let _=f;for(;_<w.length-1&&g+e.length>=w[_+1];)_++;let M=g-w[f],W=g+e.length-w[_],I=this._stringLengthToBufferSize(r+f,M);return{term:e,col:I,row:r+f,size:this._stringLengthToBufferSize(r+_,W)-I+o.cols*(_-f)}}}_stringLengthToBufferSize(e,t){let s=this._terminal.buffer.active.getLine(e);if(!s)return 0;for(let i=0;i<t;i++){let o=s.getCell(i);if(!o)break;let r=o.getChars();r.length>1&&(t-=r.length-1);let n=s.getCell(i+1);n&&n.getWidth()===0&&t++}return t}_bufferColsToStringOffset(e,t){let s=this._terminal,i=e,o=0,r=s.buffer.active.getLine(i);for(;t>0&&r;){for(let n=0;n<t&&n<s.cols;n++){let a=r.getCell(n);if(!a)break;a.getWidth()&&(o+=a.getCode()===0?1:a.getChars().length)}if(i++,r=s.buffer.active.getLine(i),r&&!r.isWrapped)break;t-=s.cols}return o}_translateBufferLineToStringWithWrap(e,t){let s=this._terminal,i=[],o=[0],r=s.buffer.active.getLine(e);for(;r;){let n=s.buffer.active.getLine(e+1),a=!!n&&n.isWrapped,d=r.translateToString(!a&&t);if(a&&n){let b=r.getCell(r.length-1);b&&b.getCode()===0&&b.getWidth()===1&&n.getCell(0)?.getWidth()===2&&(d=d.slice(0,-1))}if(i.push(d),!a)break;o.push(o[o.length-1]+d.length),e++,r=n}return[i.join(""),o]}_selectResult(e,t,s){let i=this._terminal;if(this._selectedDecoration.clear(),!e)return i.clearSelection(),!1;if(i.select(e.col,e.row,e.size),t){let o=i.registerMarker(-i.buffer.active.baseY-i.buffer.active.cursorY+e.row);if(o){let r=i.registerDecoration({marker:o,x:e.col,width:e.size,backgroundColor:t.activeMatchBackground,layer:"top",overviewRulerOptions:{color:t.activeMatchColorOverviewRuler}});if(r){let n=[];n.push(o),n.push(r.onRender(a=>this._applyStyles(a,t.activeMatchBorder,!0))),n.push(r.onDispose(()=>(0,c.disposeArray)(n))),this._selectedDecoration.value={decoration:r,match:e,dispose(){r.dispose()}}}}}if(!s&&(e.row>=i.buffer.active.viewportY+i.rows||e.row<i.buffer.active.viewportY)){let o=e.row-i.buffer.active.viewportY;o-=Math.floor(i.rows/2),i.scrollLines(o)}return!0}_applyStyles(e,t,s){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),s&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(e,t){let s=this._terminal,i=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+e.row);if(!i)return;let o=s.registerDecoration({marker:i,x:e.col,width:e.size,backgroundColor:t.matchBackground,overviewRulerOptions:this._highlightedLines.has(i.line)?void 0:{color:t.matchOverviewRuler,position:"center"}});if(o){let r=[];r.push(i),r.push(o.onRender(n=>this._applyStyles(n,t.matchBorder,!1))),r.push(o.onDispose(()=>(0,c.disposeArray)(r)))}return o}}p.SearchAddon=u})(),x})())});export{E as a};
