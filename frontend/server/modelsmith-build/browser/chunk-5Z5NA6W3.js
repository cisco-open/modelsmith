import{a as N}from"./chunk-OZEKUFJS.js";import{a as I}from"./chunk-PEPQONB2.js";import"./chunk-7XUVQUZC.js";import"./chunk-MM4TEEVS.js";import{a as M,b as Mt,c as Nt,d as z}from"./chunk-4KDFY6RG.js";import"./chunk-U7NPFWER.js";import{a as Pt,h as _t}from"./chunk-VMZY47C3.js";import{b as Ot}from"./chunk-ZPFJPO4G.js";import{A as x,Aa as Y,Ad as vt,C as Z,Ca as tt,Cc as St,Cd as f,Da as K,G as J,Gd as Ct,Ja as et,Ka as it,La as rt,Ld as At,Md as _,Na as h,P as v,Pa as U,S as W,T as C,Ta as ot,U as A,Xb as mt,Z as w,Zb as V,Zc as yt,Zd as Tt,_ as k,_b as st,a as L,b as R,dc as lt,ec as pt,fb as nt,he as Ft,ja as n,ka as c,kc as ct,lc as d,m as S,nc as ht,oc as T,pb as at,pc as F,qa as j,qc as ft,rd as O,s as $,sa as a,sd as u,uc as dt,ud as P,vc as ut,w as y,wa as m,wd as g,xa as s,xc as gt,ya as D,z as q,za as X,zd as Q}from"./chunk-XZNUB5IR.js";function Lt(r,t){if(r&1&&(m(0,"mat-option",8),h(1),s()),r&2){let e=t.$implicit;a("value",e.key),n(),U(" ",e.value," ")}}function Rt(r,t){if(r&1&&(m(0,"mat-option",8),h(1),s()),r&2){let e=t.$implicit;a("value",e.key),n(),U(" ",e.value," ")}}var l,b=(l=class{get parentFormGroup(){return this.controlContainer.control}get algorithmFormGroup(){return this.parentFormGroup.get(this.controlKey)}get algorithmFormControl(){return this.algorithmFormGroup?.get(this.ALGORITHM_CONTROL_NAME)}constructor(t,e){this.controlContainer=t,this.scriptFacadeService=e,this.controlKey="",this.pruningAlgorithmsList=Mt,this.quantAlgorithmsList=Nt,this.ALGORITHM_CONTROL_NAME="alg"}ngOnInit(){this.initForm(),this.listenToScriptStateChanges(),this.loadInitialData()}loadInitialData(){this.scriptFacadeService.scriptDetails$.pipe(J(1),x(1),y(t=>!vt(t?.algKey))).subscribe(t=>{let e=t.type,o=e===f.PRUNING||e===f.QUANTIZATION?t.algKey:z;this.algorithmFormControl?.setValue(o)}),this.scriptFacadeService.dispatch(P.getCurrentOrLastActiveScriptDetails())}initForm(){this.parentFormGroup.addControl(this.controlKey,new F({[this.ALGORITHM_CONTROL_NAME]:new ft(z,ct.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(u(this)).subscribe(t=>{g(t)?this.algorithmFormGroup.disable():this.algorithmFormGroup.enable()})}trackByAlgorithmKey(t,e){return e.key}ngOnDestroy(){this.parentFormGroup.removeControl(this.controlKey)}},l.\u0275fac=function(e){return new(e||l)(c(d),c(_))},l.\u0275cmp=C({type:l,selectors:[["ms-panel-algorithm"]],inputs:{controlKey:"controlKey"},features:[ot([],[{provide:d,useFactory:()=>W(d,{skipSelf:!0})}])],decls:10,vars:6,consts:[[1,"ms-card","algorithm-card"],[1,"heading-sub-section-title"],[1,"form-field-container",3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],[3,"formControlName"],["label","Pruning"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["label","Quantization"],[3,"value"]],template:function(e,i){e&1&&(m(0,"mat-card",0)(1,"p",1),h(2,"Algorithm"),s(),m(3,"div",2)(4,"mat-form-field",3)(5,"mat-select",4)(6,"mat-optgroup",5),j(7,Lt,2,2,"mat-option",6),s(),m(8,"mat-optgroup",7),j(9,Rt,2,2,"mat-option",6),s()()()()()),e&2&&(n(3),a("formGroupName",i.controlKey),n(2),a("formControlName",i.ALGORITHM_CONTROL_NAME),n(2),a("ngForOf",i.pruningAlgorithmsList)("ngForTrackBy",i.trackByAlgorithmKey),n(2),a("ngForOf",i.quantAlgorithmsList)("ngForTrackBy",i.trackByAlgorithmKey))},dependencies:[nt,Tt,yt,Ft,pt,lt,ht,T,gt,ut]}),l);b=S([O()],b);var H="custommodel";function It(r){let t=r.replace(/[^a-zA-Z0-9_]/g,"_");return/^[0-9_]/.test(t)&&(t="file_"+t),/.py$/.test(t)||(t+=".py"),t}var kt=["panelParameters"],p,G=(p=class{constructor(t,e,i,o){this.scriptFacadeService=t,this.fileService=e,this.snackbarService=i,this.router=o,this.form=new F({}),this.AlgorithmType=f,this.isScriptActive=!1,this.isQuantAlgorithmSelected=!1,this.selectedAlgorithm=Ct.IMP,this.selectedAlgorithmType=f.PRUNING}ngOnInit(){this.listenToAlgorithmPanelChanges(),this.listenToScriptStateChanges()}listenToAlgorithmPanelChanges(){this.form.valueChanges.pipe(q(50),$(()=>{let t=this.form.getRawValue();return t.algorithm&&t.algorithm.alg}),Z(),y(t=>!Q(t)),u(this)).subscribe(t=>{this.selectedAlgorithm=t,this.selectedAlgorithmType=At(t)})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(u(this)).subscribe(t=>{this.isScriptActive=g(t),g(t)?this.form.disable():this.form.enable()})}submit(){if(Q(this.selectedAlgorithm)){this.snackbarService.showError("Select an algorithm before running a script.");return}let{algorithm:t,model:e}=this.form.getRawValue(),{model:i}=e;if(i===H&&!this.fileService.isFileLoaded){this.snackbarService.showError("Please select a predefined model or upload a custom file.");return}let o=i===H?It(this.fileService?.file.name):i,E=R(L({},t),{params:R(L({},this.panelParametersComponent.parametersFormatted),{arch:o})});this.scriptFacadeService.dispatch(P.callScript({configs:E}))}goToChartPage(){this.router.navigate([st.RUNNING.ROOT])}},p.\u0275fac=function(e){return new(e||p)(c(_),c(_t),c(Pt),c(mt))},p.\u0275cmp=C({type:p,selectors:[["ms-machine-unlearning"]],viewQuery:function(e,i){if(e&1&&et(kt,5),e&2){let o;it(o=rt())&&(i.panelParametersComponent=o.first)}},decls:17,vars:5,consts:[["panelAlgorithm",""],["panelParameters",""],[1,"heading-primary-title","title"],[1,"page-wrapper",3,"formGroup"],[1,"left"],[3,"formGroup"],["controlKey","algorithm"],["controlKey","model",3,"algorithmType"],["controlKey","params",3,"algorithm"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"ml-2",3,"click"],[1,"right"]],template:function(e,i){if(e&1){let o=tt();m(0,"p",2),h(1,"Model Compression"),s(),m(2,"div",3)(3,"div",4),X(4,5),D(5,"ms-panel-algorithm",6,0)(7,"ms-panel-model",7)(8,"ms-panel-parameters",8,1),Y(),m(10,"div")(11,"button",9),K("click",function(){return w(o),k(i.submit())}),h(12," Run "),s(),m(13,"button",10),K("click",function(){return w(o),k(i.goToChartPage())}),h(14,"View Chart"),s()()(),m(15,"div",11),D(16,"ms-terminal"),s()()}e&2&&(n(2),a("formGroup",i.form),n(2),a("formGroup",i.form),n(3),a("algorithmType",i.selectedAlgorithmType),n(),a("algorithm",i.selectedAlgorithm),n(3),a("disabled",i.isScriptActive||i.form.invalid))},dependencies:[St,T,dt,M,N,I,b],styles:[".title[_ngcontent-%COMP%]{margin-bottom:13px}"]}),p);G=S([O()],G);var jt=[{path:"",component:G}],bt=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=A({type:t}),t.\u0275inj=v({imports:[V.forChild(jt),V]});let r=t;return r})();var ke=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=A({type:t}),t.\u0275inj=v({imports:[at,Ot,bt,M,N,I]});let r=t;return r})();export{ke as ModelCompressionModule};
