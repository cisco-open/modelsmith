import{a as pt,b as ct,c as dt}from"./chunk-XD2XL32D.js";import{a as st}from"./chunk-3GNVUME3.js";import{a as fe}from"./chunk-R5J4FM6S.js";import{b as ot,c as rt,e as mt,f as lt}from"./chunk-DQ7AOZDA.js";import{b as We}from"./chunk-3S6QBQVM.js";import"./chunk-D2Y5ESR4.js";import"./chunk-TO7IPVMR.js";import{a as pe,b as ce}from"./chunk-G267DK6J.js";import"./chunk-GSC3HYC7.js";import{a as Qe,b as ze}from"./chunk-VUPIOU6P.js";import"./chunk-PP7DOJYP.js";import{a as de}from"./chunk-QVZ2CSJP.js";import{a as w,c as V}from"./chunk-WHP5P3DQ.js";import"./chunk-SMKHMGDE.js";import{b as O,d as Xe,e as G,f as et,g as c,h as tt,n as y,o as it}from"./chunk-W4U3FJPJ.js";import{a as K,b as se}from"./chunk-2FJ2YO2M.js";import{a as le,b as L,d as nt,l as at}from"./chunk-PSFPSLKI.js";import{a as P,b as f}from"./chunk-GMIVG7ET.js";import"./chunk-NT2MTW7W.js";import{h as re,i as ne}from"./chunk-HG2O7P4S.js";import{$ as z,$b as Ue,Ab as Z,Ae as me,Bb as xe,E as b,Ea as r,Fa as p,Fb as A,Gb as E,Hb as Re,I as ye,Ib as ke,J as Ie,L as Me,Q,Qa as d,R as Ae,Sa as n,Tb as R,Td as $e,Ub as q,Ud as W,Vb as De,Wb as Le,Xb as Ke,_b as Ve,a as Fe,ab as m,ac as Be,b as Ne,bb as a,bc as J,be as X,cb as g,ce as v,da as H,db as u,dd as je,eb as h,ee,fe as k,gb as be,ge as D,ha as I,ia as Y,ie as j,jb as Te,lb as M,le as He,me as Ye,ne as te,oa as Pe,p as F,pa as Ce,pe as ie,qa as _e,qb as Ee,rb as Oe,sb as Ge,sc as Se,se as Ze,tb as we,te as oe,ub as l,ue as qe,vb as B,wb as x,x as N,xe as Je,ze as ae}from"./chunk-NPZHNGVX.js";function Tt(o,e){o&1&&g(0,"mat-icon",13)}function St(o,e){if(o&1&&(m(0,"mat-option",11),l(1),d(2,Tt,1,0,"mat-icon",12),a()),o&2){let t=e.$implicit;n("value",t.name),r(),x(" ",t.name," "),r(),n("ngIf",!t.isTrained)}}function Ft(o,e){o&1&&(m(0,"mat-option",14),l(1,"No results found"),a())}function Nt(o,e){if(o&1&&(u(0),d(1,St,3,3,"mat-option",9)(2,Ft,2,0,"mat-option",10),h()),o&2){let t=e.ngIf,i=M();r(),n("ngForOf",t)("ngForTrackBy",i.trackByModel),r(),n("ngIf",t.length===0)}}var C,U=(C=class{ngOnChanges(e){e.algorithmType&&e.algorithmType.currentValue&&this.configureModels(e.algorithmType.currentValue)}get parentFormGroup(){return this.controlContainer.control}get modelFormGroup(){return this.parentFormGroup.get(this.controlKey)}get modelControl(){return this.modelFormGroup?.get(this.MODEL_CONTROL_NAME)}constructor(e,t,i,s){this.controlContainer=e,this.modelsFacadeService=t,this.scriptFacadeService=i,this.pageRunningScriptSpiningIndicatorService=s,this.controlKey="",this.PageKey=ot,this.RoutesList=je,this.searchModel=new j,this.models=[],this.MODEL_CONTROL_NAME="model"}ngOnInit(){this.initializeForm(),this.listenToScriptStateChanges(),this.listenToSearchModelValueChanges(),this.configureModels(this.algorithmType)}configureModels(e){if(e)switch(this.getModelsByTypeSubscription?.unsubscribe(),this.getModelsByTypeSubscription=this.subscribeToModelsListChanges(e),this.modelsFacadeService.dispatch(w.getModelsList({algorithmType:e})),e){case c.PRUNING:{this.modelsFacadeService.dispatch(w.getCurrentOrPreviousSelectedModel({algorithmType:y.PRUNING_TRAIN}));break}case c.QUANTIZATION:{this.modelsFacadeService.dispatch(w.getCurrentOrPreviousSelectedModel({algorithmType:y.QUANTIZATION_TRAIN}));break}case c.MACHINE_UNLEARNING:{this.modelsFacadeService.dispatch(w.getCurrentOrPreviousSelectedModel({algorithmType:y.MACHINE_UNLEARNING_TRAIN}));break}}}listenToCurrentModelChanges(){this.modelsFacadeService.currentModel$.pipe(f(this)).subscribe(e=>{if(G(e))return;this.models.find(i=>i.name===e)&&this.modelControl?.patchValue(e)})}subscribeToModelsListChanges(e){let t=!1;return this.modelsFacadeService.getModelsByType(e).pipe(b(i=>!et(i)),N(i=>[...i].sort((s,ve)=>Number(ve.isTrained)-Number(s.isTrained)))).subscribe(i=>{this.models=i,this.searchModel.setValue(""),t||(this.listenToCurrentModelChanges(),t=!0)})}initializeForm(){this.parentFormGroup.addControl(this.controlKey,new D({[this.MODEL_CONTROL_NAME]:new j("",X.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(f(this)).subscribe(e=>{O(e)?this.modelFormGroup.disable():this.modelFormGroup.enable()})}listenToSearchModelValueChanges(){this.filteredModels=this.searchModel.valueChanges.pipe(f(this),Ae(""),N(e=>this.filterModels(e)))}filterModels(e){let t=e.toLowerCase();return this.models.filter(i=>i.name.toLowerCase().includes(t))}trackByModel(e,t){return t.name}ngOnDestroy(){this.parentFormGroup.removeControl(this.controlKey)}},C.\u0275fac=function(t){return new(t||C)(p(v),p(V),p(L),p(rt))},C.\u0275cmp=I({type:C,selectors:[["ms-panel-model-training"]],inputs:{controlKey:"controlKey",algorithmType:"algorithmType"},standalone:!0,features:[Z([],[{provide:v,useFactory:()=>H(v,{skipSelf:!0})}]),Pe,xe],decls:12,vars:5,consts:[[1,"ms-card","model-card"],[1,"panel-title-wrapper"],[1,"heading-sub-section-title"],[1,"form-field-container",3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","model","placeholder","Select a model..."],["label","Predefined Models"],[3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["disabled","",4,"ngIf"],[3,"value"],["class","mat-error","fontSet","ms","fontIcon","icon-X",4,"ngIf"],["fontSet","ms","fontIcon","icon-X",1,"mat-error"],["disabled",""]],template:function(t,i){t&1&&(m(0,"mat-card",0)(1,"div",1)(2,"div",2),l(3,"Model"),a()(),m(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-optgroup",6)(8,"mat-option"),g(9,"ngx-mat-select-search",7),a(),d(10,Nt,3,3,"ng-container",8),A(11,"async"),a()()()()()),t&2&&(r(4),n("formGroupName",i.controlKey),r(5),n("formControl",i.searchModel),r(),n("ngIf",E(11,3,i.filteredModels)))},dependencies:[oe,ee,k,He,ie,te,se,K,ne,re,ce,pe,W,$e,me,ae,J,R,q,Ve,lt,mt,We],styles:[".panel-title-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px}.panel-title-wrapper[_ngcontent-%COMP%]   .train-models[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]}),C);U=F([P()],U);function Pt(o,e){if(o&1&&(m(0,"mat-option",7),l(1),a()),o&2){let t=e.$implicit;n("value",t.key),r(),x(" ",t.value," ")}}var _,ge=(_=class{get parentFormGroup(){return this.controlContainer.control}get algorithmTypeFormGroup(){return this.parentFormGroup.get(this.controlKey)}get algorithmTypeFormControl(){return this.algorithmTypeFormGroup.get(this.ALGORITHM_TYPE_CONTROL_NAME)}constructor(e,t){this.controlContainer=e,this.scriptFacadeService=t,this.controlKey="",this.algorithmTypesOptions=tt.filter(i=>i.key!==c.TRAIN&&i.key!==c.AWQ),this.ALGORITHM_TYPE_CONTROL_NAME="algorithmType"}ngOnInit(){this.initForm(),this.loadInitialData(),this.listenToScriptStateChanges()}loadInitialData(){this.scriptFacadeService.scriptDetails$.pipe(Q(1),Ie(1),b(e=>!G(e?.algKey)),N(e=>e.algKey)).subscribe(e=>{switch(e){case y.PRUNING_TRAIN:{this.algorithmTypeFormControl.patchValue(c.PRUNING);break}case y.MACHINE_UNLEARNING_TRAIN:{this.algorithmTypeFormControl.patchValue(c.MACHINE_UNLEARNING);break}case y.QUANTIZATION_TRAIN:{this.algorithmTypeFormControl.patchValue(c.QUANTIZATION);break}default:this.algorithmTypeFormControl.patchValue(c.PRUNING)}}),this.scriptFacadeService.dispatch(le.getCurrentOrLastActiveScriptDetails())}initForm(){this.parentFormGroup.addControl(this.controlKey,new D({[this.ALGORITHM_TYPE_CONTROL_NAME]:new j(c.PRUNING,X.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(f(this)).subscribe(e=>{O(e)?this.algorithmTypeFormGroup.disable():this.algorithmTypeFormGroup.enable()})}trackByAlgorithmType(e,t){return t.key}},_.\u0275fac=function(t){return new(t||_)(p(v),p(L))},_.\u0275cmp=I({type:_,selectors:[["ms-panel-algorithm-type-for-training"]],inputs:{controlKey:"controlKey"},features:[Z([],[{provide:v,useFactory:()=>H(v,{skipSelf:!0})}])],decls:8,vars:4,consts:[[1,"ms-card","parameters-card"],[1,"heading-sub-section-title"],[3,"formGroupName"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],[3,"formControlName"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value"]],template:function(t,i){t&1&&(m(0,"mat-card",0)(1,"p",1),l(2,"Algorithm Type"),a(),u(3,2),m(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5),d(7,Pt,2,2,"mat-option",6),a()()(),h(),a()),t&2&&(r(3),n("formGroupName",i.controlKey),r(3),n("formControlName",i.ALGORITHM_TYPE_CONTROL_NAME),r(),n("ngForOf",i.algorithmTypesOptions)("ngForTrackBy",i.trackByAlgorithmType))},dependencies:[R,K,re,pe,W,ee,k,ie,te]}),_);ge=F([P()],ge);function Et(o,e){if(o&1&&(u(0),l(1),A(2,"adaptiveFileSize"),h()),o&2){let t=M().$implicit;r(),B(E(2,1,t.value))}}function Ot(o,e){if(o&1&&(u(0),l(1),A(2,"date"),h()),o&2){let t=M().$implicit;r(),B(Re(2,1,t.value,"medium"))}}function Gt(o,e){if(o&1&&(u(0),l(1),A(2,"readableDuration"),h()),o&2){let t=M().$implicit;r(),B(E(2,1,t.value))}}function wt(o,e){if(o&1&&(u(0),l(1),h()),o&2){let t=M().$implicit;r(),B(t.value)}}function xt(o,e){o&1&&(m(0,"div",15),g(1,"mat-divider"),a())}function Rt(o,e){if(o&1&&(m(0,"div")(1,"div",8)(2,"div",9),l(3),A(4,"parametersLabel"),a(),m(5,"div",10),u(6,11),d(7,Et,3,3,"ng-container",12)(8,Ot,3,4,"ng-container",12)(9,Gt,3,3,"ng-container",12)(10,wt,2,1,"ng-container",13),h(),a()(),d(11,xt,2,0,"div",14),a()),o&2){let t=e.$implicit,i=e.last;r(3),x("",E(4,6,t.key),":"),r(3),n("ngSwitch",t.key),r(),n("ngSwitchCase","file_size_bytes"),r(),n("ngSwitchCase","creation_date"),r(),n("ngSwitchCase","training_duration_seconds"),r(2),n("ngIf",!i)}}function kt(o,e){if(o&1&&(m(0,"div",6),d(1,Rt,12,8,"div",7),a()),o&2){let t=M().$implicit;r(),n("ngForOf",t)}}function Dt(o,e){if(o&1&&(m(0,"div",4),d(1,kt,2,1,"div",5),a()),o&2){let t=e.$implicit;M();let i=we(6);r(),n("ngIf",t.length>0)("ngIfElse",i)}}function Lt(o,e){o&1&&g(0,"ms-empty-state",16)}var T,ue=(T=class{constructor(e){this.modelsFacadeService=e,this.metadata={}}ngOnInit(){this.modelsFacadeService.modelMetadata$.pipe(Q(1),f(this)).subscribe(e=>{this.metadata=e})}},T.\u0275fac=function(t){return new(t||T)(p(V))},T.\u0275cmp=I({type:T,selectors:[["ms-panel-model-metadata"]],decls:7,vars:3,consts:[["noMetadata",""],[1,"ms-card","metadata-card"],[1,"heading-sub-section-title"],["class","metadata-wrapper",4,"ngIf"],[1,"metadata-wrapper"],["class","key-value-container single",4,"ngIf","ngIfElse"],[1,"key-value-container","single"],[4,"ngFor","ngForOf"],[1,"key-value-pair","space-between"],[1,"key-value-key"],[1,"key-value-value"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","pt-2",4,"ngIf"],[1,"pt-2"],["title","No metadata available"]],template:function(t,i){t&1&&(m(0,"mat-card",1)(1,"p",2),l(2,"Model Training Information"),a(),d(3,Dt,2,2,"div",3),A(4,"keyvalue"),d(5,Lt,1,0,"ng-template",null,0,ke),a()),t&2&&(r(3),n("ngIf",E(4,1,i.metadata)))},dependencies:[R,q,De,Le,Ke,st,K,Qe,Ue,Be,pt,dt,ct],styles:[".metadata-wrapper[_ngcontent-%COMP%]{max-height:300px;overflow:auto;padding-right:20px}"]}),T);ue=F([P()],ue);var Vt=["panelParameters"],S,he=(S=class{constructor(e,t,i,s){this.navigationService=e,this.scriptFacadeService=t,this.snackbarService=i,this.modelsFacadeService=s,this.form=new D({}),this.isScriptActive=!1,this.selectedAlgorithmType=c.PRUNING,this.selectedAlgorithmKey=y.PRUNING_TRAIN}ngOnInit(){this.listenToAlgorithmPanelChanges(),this.listenToScriptStateChanges(),this.listenToFormChangesToLoadModelMetadata()}listenToAlgorithmPanelChanges(){this.form.valueChanges.pipe(ye(50),N(()=>{let e=this.form.getRawValue();return e.algorithmTypeGroup&&e.algorithmTypeGroup.algorithmType}),Me(),b(e=>!!e),f(this)).subscribe(e=>{this.selectedAlgorithmType=e,this.selectedAlgorithmKey=it[e]})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(f(this)).subscribe(e=>{this.isScriptActive=O(e),O(e)?this.form.disable():this.form.enable()})}listenToFormChangesToLoadModelMetadata(){this.form.valueChanges.pipe(ye(50),N(e=>{let t=e.algorithmTypeGroup?.algorithmType,i=e.model?.model;return{algorithmType:t,model:i}}),Me((e,t)=>JSON.stringify(e)===JSON.stringify(t)),b(({algorithmType:e,model:t})=>!G(e)&&!G(t)),f(this)).subscribe(({algorithmType:e,model:t})=>{this.modelsFacadeService.dispatch(w.getModelMetadata({algorithmType:e,modelName:t}))})}submit(){if(Xe(this.selectedAlgorithmType)){this.snackbarService.showError("Select an algorithm before running a script.");return}let{model:e}=this.form.getRawValue(),{model:t}=e,i={alg:this.selectedAlgorithmKey,params:Ne(Fe({},this.panelParametersComponent.parametersFormatted),{arch:t})};this.scriptFacadeService.dispatch(le.callScript({configs:i}))}},S.\u0275fac=function(t){return new(t||S)(p(at),p(L),p(nt),p(V))},S.\u0275cmp=I({type:S,selectors:[["ms-model-training"]],viewQuery:function(t,i){if(t&1&&Ee(Vt,5),t&2){let s;Oe(s=Ge())&&(i.panelParametersComponent=s.first)}},decls:17,vars:4,consts:[["panelParameters",""],[1,"heading-primary-title","title"],[1,"page-wrapper"],[1,"left",3,"formGroup"],["controlKey","algorithmTypeGroup"],["controlKey","model",3,"algorithmType"],["controlKey","params",3,"algorithm"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","primary",1,"ml-2",3,"click"],["fontSet","ms","fontIcon","icon-ArrowLeft"],[1,"right"]],template:function(t,i){if(t&1){let s=be();m(0,"p",1),l(1,"Model Training"),a(),m(2,"div",2)(3,"div",3),g(4,"ms-panel-algorithm-type-for-training",4)(5,"ms-panel-model-training",5)(6,"ms-panel-model-metadata")(7,"ms-panel-parameters",6,0),m(9,"div")(10,"button",7),Te("click",function(){return Ce(s),_e(i.submit())}),l(11," Run "),a(),m(12,"button",8),Te("click",function(){return Ce(s),_e(i.navigationService.goToPreviousPage())}),g(13,"mat-icon",9),l(14," Go back "),a()()(),m(15,"div",10),g(16,"ms-terminal"),a()()}t&2&&(r(3),n("formGroup",i.form),r(2),n("algorithmType",i.selectedAlgorithmType),r(2),n("algorithm",i.selectedAlgorithmKey),r(3),n("disabled",i.isScriptActive||i.form.invalid))},dependencies:[de,U,fe,k,Ye,ae,qe,ge,ue],styles:[".title[_ngcontent-%COMP%]{margin-bottom:13px}"]}),S);he=F([P()],he);var Ut=[{path:"",component:he}],vt=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Y({type:e}),e.\u0275inj=z({imports:[Se.forChild(Ut),Se]});let o=e;return o})();var To=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=Y({type:e}),e.\u0275inj=z({imports:[J,vt,de,U,fe,se,ze,ce,ne,Ze,oe,me,Je]});let o=e;return o})();export{To as ModelTrainingModule};
