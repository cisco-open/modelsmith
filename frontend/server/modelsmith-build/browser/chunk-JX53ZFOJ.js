import{b as A,d as k,e as se}from"./chunk-NMUT6352.js";import{a as oe,b as D}from"./chunk-A4AKQLQB.js";import{b as te}from"./chunk-C4NPICWQ.js";import{a as pe,b as he,c as ne}from"./chunk-YRSJWEPX.js";import{a as Y,b as Z}from"./chunk-TGB2NBUR.js";import{b as F,c as ie}from"./chunk-XX6ZYDLH.js";import{f as re}from"./chunk-MYRXADOO.js";import{a as ee,b as C}from"./chunk-K6MLUSZ7.js";import{i as X,k as K}from"./chunk-3DEWYFT2.js";import{Aa as a,B as E,Ec as f,G as S,H as P,Na as g,W as O,Xa as s,Xb as N,Ya as p,Z as V,Za as u,bb as j,ca as T,e as R,eb as h,ee as Q,f as I,ka as c,la as m,lb as H,mb as B,nb as x,ob as z,pb as y,pe as $,qb as W,qe as U,sa as b,te as q,ua as d,ue as L,wb as w,we as G,xb as M,xe as J,za as v}from"./chunk-ED6LLMLR.js";var le=R(pe()),ce=R(he());var ue=["terminal"],ge=(()=>{let i=class i{constructor(e,t,r){this.destroyRef=e,this.terminalWebSocketService=t,this.terminalStylesService=r,this.fitAddon=new le.FitAddon,this.searchAddon=new ce.SearchAddon}ngOnInit(){this.initializeTerminal(),this.subscribeToWebSocketMessages()}ngAfterViewInit(){requestAnimationFrame(()=>{this.adjustTerminalContainer()})}initializeTerminal(){this.terminal=this.terminalStylesService.createTerminalInstance(),this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(this.searchAddon),this.terminal.open(this.terminalDiv.nativeElement),this.setupResizeObserver(),this.terminal.onData(e=>{this.terminalWebSocketService.sendMessage(e)})}subscribeToWebSocketMessages(){this.terminalWebSocketService.messages$.pipe(f(this.destroyRef)).subscribe(e=>{this.terminal.write(e)})}setupResizeObserver(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(()=>{this.adjustTerminalContainer()}),this.resizeObserver.observe(this.terminalDiv.nativeElement)}adjustTerminalContainer(){this.adjustHeightToParent(),this.fitAddon.fit()}adjustHeightToParent(){let e=this.terminalDiv.nativeElement.parentElement.parentElement.parentElement.parentElement;if(e){this.terminalDiv.nativeElement.style.height="auto";let o=e.offsetHeight-100;this.terminalDiv.nativeElement.style.height=`${o}px`}}ngOnDestroy(){this.resizeObserver?.disconnect(),this.terminal.dispose()}search(e){this.searchAddon.findNext(e,{decorations:this.terminalStylesService.getSearchDecorationOptions()})}clearSearch(){this.searchAddon.clearDecorations(),this.searchAddon.findNext("")}clearTerminal(){this.terminal.clear()}scrollToTop(){this.terminal.scrollToTop()}scrollToBottom(){this.terminal.scrollToBottom()}};i.\u0275fac=function(t){return new(t||i)(a(b),a(D),a(ne))},i.\u0275cmp=T({type:i,selectors:[["ms-terminal-xterm"]],viewQuery:function(t,r){if(t&1&&H(ue,7),t&2){let o;B(o=x())&&(r.terminalDiv=o.first)}},inputs:{options:"options"},standalone:!0,features:[w([C,oe]),M],decls:2,vars:0,consts:[["terminal",""],[1,"terminal-wrapper"]],template:function(t,r){t&1&&u(0,"div",1,0)}});let n=i;return n})();var _=(()=>{let i=class i{constructor(e){this.dialogService=e}openFullScreenDialog(e){return I(this,null,function*(){if(e)return;let{MsTerminalFullscreenDialogComponent:t}=yield import("./chunk-TSU7XT7W.js");document.body.classList.add("no-scroll"),this.dialogService.open(t,{showHeader:!1,showFooter:!1,showSaveButton:!1,width:"100vw",height:"100vh"}).afterClosed().pipe(S(1)).subscribe(()=>{document.body.classList.remove("no-scroll")})})}openMessagesHistoryDialog(){return I(this,null,function*(){let{MsTerminalMessagesHistoryDialogComponent:e}=yield import("./chunk-BTR3L6UW.js");this.dialogService.open(e,{title:"Terminal history",showSaveButton:!1,width:"60vw",height:"75vh"})})}};i.\u0275fac=function(t){return new(t||i)(V(re))},i.\u0275prov=O({token:i,factory:i.\u0275fac});let n=i;return n})();var Je=(()=>{let i=class i{constructor(e,t,r,o,l){this.destroyRef=e,this.scriptFacadeService=t,this.terminalWebSocketService=r,this.terminalDialogService=o,this.popoverService=l,this.isFullscreen=!1,this.isScriptActive=!1,this.popoverId="",this.clearTerminal=new d,this.scrollToTopTerminal=new d,this.scrollToBottomTerminal=new d,this.searchTerminal=new d,this.disposeSearch=new d,this.exitFullscreen=new d,this.searchFormControl=new Q("")}ngOnInit(){this.listenToScriptStateChanges(),this.listenToSearchFormControlChanges()}clearTerminalScreen(){this.terminalWebSocketService.clearScreen()}openPanel(e){F(this.searchPanelRef)&&(this.searchPanelRef=this.popoverService.open(se,e._elementRef,{position:this.isFullscreen?A.BOTTOM:A.TOP,width:"200px",height:"60px"},this.popoverId??""),this.searchPanelRef.data$.pipe(f(this.destroyRef)).subscribe(t=>{this.searchTerminal.emit(t)}),this.searchPanelRef.afterClosed().pipe(S(1)).subscribe(()=>{this.searchPanelRef=void 0,this.disposeSearch.emit()}))}listenToSearchFormControlChanges(){this.searchFormControl.valueChanges.pipe(f(this.destroyRef),P(300),E(e=>!ie(e))).subscribe(e=>{this.searchTerminal.emit(e)})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(f(this.destroyRef)).subscribe(e=>{this.isScriptActive=te(e)})}ctaStopScript(){this.scriptFacadeService.dispatch(ee.stopScript())}openTerminalMessagesHistoryDialog(){F(this.searchPanelRef)||this.searchPanelRef?.close(),this.terminalDialogService.openMessagesHistoryDialog()}openFullScreenMode(){if(this.isFullscreen){this.exitFullscreen.emit();return}this.searchPanelRef?.close(),this.terminalDialogService.openFullScreenDialog(this.isFullscreen)}ngOnDestroy(){F(this.searchPanelRef)||this.searchPanelRef?.close()}};i.\u0275fac=function(t){return new(t||i)(a(b),a(C),a(D),a(_),a(k))},i.\u0275cmp=T({type:i,selectors:[["ms-terminal-toolbar"]],inputs:{isFullscreen:"isFullscreen",isScriptActive:"isScriptActive",popoverId:"popoverId"},outputs:{clearTerminal:"clearTerminal",scrollToTopTerminal:"scrollToTopTerminal",scrollToBottomTerminal:"scrollToBottomTerminal",searchTerminal:"searchTerminal",disposeSearch:"disposeSearch",exitFullscreen:"exitFullscreen"},standalone:!0,features:[w([_,k]),M],decls:19,vars:4,consts:[["searchTooltip",""],[1,"buttons-wrapper"],["mat-icon-button","","color","primary","matTooltip","Search terminal",3,"click"],["fontSet","ms","fontIcon","icon-MagnifyingGlass"],["mat-icon-button","","color","primary","matTooltip","Terminal history",3,"click"],["mat-icon-button","","color","primary","matTooltip","Scroll to top",3,"click"],["fontSet","ms","fontIcon","icon-ArrowUp"],["mat-icon-button","","color","primary","matTooltip","Scroll to bottom",3,"click"],["fontSet","ms","fontIcon","icon-ArrowDown"],["mat-icon-button","","color","primary","matTooltip","Clear terminal",3,"click","disabled"],["mat-icon-button","","color","primary",3,"click","matTooltip"],["mat-icon-button","","color","warn","matTooltip","Stop current process",3,"click","disabled"],["fontSet","ms","fontIcon","icon-X",1,"mat-error"]],template:function(t,r){if(t&1){let o=j();s(0,"div",1)(1,"button",2,0),h("click",function(){c(o);let me=z(2);return m(r.openPanel(me))}),u(3,"mat-icon",3),p(),s(4,"button",4),h("click",function(){return c(o),m(r.openTerminalMessagesHistoryDialog())}),s(5,"mat-icon"),y(6,"history"),p()(),s(7,"button",5),h("click",function(){return c(o),m(r.scrollToTopTerminal.emit())}),u(8,"mat-icon",6),p(),s(9,"button",7),h("click",function(){return c(o),m(r.scrollToBottomTerminal.emit())}),u(10,"mat-icon",8),p(),s(11,"button",9),h("click",function(){return c(o),m(r.clearTerminalScreen())}),s(12,"mat-icon"),y(13," clear_all"),p()(),s(14,"button",10),h("click",function(){return c(o),m(r.openFullScreenMode())}),s(15,"mat-icon"),y(16),p()(),s(17,"button",11),h("click",function(){return c(o),m(r.ctaStopScript())}),u(18,"mat-icon",12),p()()}t&2&&(v(11),g("disabled",r.isScriptActive),v(3),g("matTooltip",r.isFullscreen?"Exit fullscreen":"Enter fullscreen"),v(2),W(r.isFullscreen?"fullscreen_exit":"fullscreen"),v(),g("disabled",!r.isScriptActive))},dependencies:[N,L,q,J,G,Z,Y,$,U,X,K]});let n=i;return n})();export{ge as a,Je as b};
