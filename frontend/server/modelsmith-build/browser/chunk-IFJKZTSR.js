import{a as at,b as mt,c as lt}from"./chunk-KKBNVFSA.js";import{a as nt}from"./chunk-LSF6MDDG.js";import{a as de}from"./chunk-D4NO5T2F.js";import{b as Xe,c as et,e as ot,f as rt}from"./chunk-M3BJA4RX.js";import{b as Ye}from"./chunk-DFEVON6A.js";import"./chunk-HHI42NCD.js";import"./chunk-YTNKLUWY.js";import{a as se,b as pe}from"./chunk-A3HRP5BG.js";import"./chunk-VRD7QX3W.js";import{a as Ue,b as je}from"./chunk-452CEXFK.js";import"./chunk-SWEZDJOL.js";import{a as ce}from"./chunk-OMCAGIEN.js";import{a as G,c as V}from"./chunk-BY5EH3KZ.js";import"./chunk-W5GEUOC3.js";import{b as E,d as Ze,e as O,f as qe,g as p,h as Je,n as g,o as We}from"./chunk-W4U3FJPJ.js";import{a as K,b as le}from"./chunk-I4357ONH.js";import{a as me,b as D,d as tt,l as it}from"./chunk-KE2JE72J.js";import{a as I,b as d}from"./chunk-COKZMNNS.js";import"./chunk-LDDHJMMZ.js";import{h as oe,i as re}from"./chunk-RTK5DRKR.js";import{$ as z,$a as R,$d as h,Ab as Z,Bb as Re,E as P,Ea as n,Fa as s,Fb as A,Gb as b,Hb as we,I as ge,J as Fe,L as Ce,Q,Qa as C,Qd as Ve,R as Ne,Rd as J,Sa as c,Xb as ke,Ya as M,Yb as Le,Za as Ie,Zb as De,_a as x,_b as q,_d as W,a as Te,ab as m,ad as Ke,b as Se,bb as r,be as X,cb as f,ce as k,da as H,db as Pe,de as L,eb as be,fe as $,gb as Ee,ha as N,ia as Y,ie as $e,jb as _e,je as Be,ke as ee,lb as w,me as te,oa as Ae,p as S,pa as Me,pc as ve,pe as Qe,qa as ye,qb as Oe,qe as ie,rb as Ge,re as ze,sb as xe,ub as l,ue as He,wb as u,we as ne,x as F,xe as ae}from"./chunk-I5FNXPEQ.js";var Mt=(i,e)=>e.name;function yt(i,e){i&1&&f(0,"mat-icon",10)}function _t(i,e){if(i&1&&(m(0,"mat-option",8),l(1),C(2,yt,1,0,"mat-icon",10),r()),i&2){let t=e.$implicit;c("value",t.name),n(),u(" ",t.name," "),n(),M(t.isTrained?-1:2)}}function vt(i,e){i&1&&(m(0,"mat-option",9),l(1,"No results found"),r())}function Tt(i,e){if(i&1&&(x(0,_t,3,3,"mat-option",8,Mt),C(2,vt,2,0,"mat-option",9)),i&2){let t=e;R(t),n(2),M(t.length===0?2:-1)}}var y,U=(y=class{ngOnChanges(e){e.algorithmType&&e.algorithmType.currentValue&&this.configureModels(e.algorithmType.currentValue)}get parentFormGroup(){return this.controlContainer.control}get modelFormGroup(){return this.parentFormGroup.get(this.controlKey)}get modelControl(){return this.modelFormGroup?.get(this.MODEL_CONTROL_NAME)}constructor(e,t,o,a){this.controlContainer=e,this.modelsFacadeService=t,this.scriptFacadeService=o,this.pageRunningScriptSpiningIndicatorService=a,this.controlKey="",this.PageKey=Xe,this.RoutesList=Ke,this.searchModel=new $,this.models=[],this.MODEL_CONTROL_NAME="model"}ngOnInit(){this.initializeForm(),this.listenToScriptStateChanges(),this.listenToSearchModelValueChanges(),this.configureModels(this.algorithmType)}configureModels(e){if(e)switch(this.getModelsByTypeSubscription?.unsubscribe(),this.getModelsByTypeSubscription=this.subscribeToModelsListChanges(e),this.modelsFacadeService.dispatch(G.getModelsList({algorithmType:e})),e){case p.PRUNING:{this.modelsFacadeService.dispatch(G.getCurrentOrPreviousSelectedModel({algorithmType:g.PRUNING_TRAIN}));break}case p.QUANTIZATION:{this.modelsFacadeService.dispatch(G.getCurrentOrPreviousSelectedModel({algorithmType:g.QUANTIZATION_TRAIN}));break}case p.MACHINE_UNLEARNING:{this.modelsFacadeService.dispatch(G.getCurrentOrPreviousSelectedModel({algorithmType:g.MACHINE_UNLEARNING_TRAIN}));break}}}listenToCurrentModelChanges(){this.modelsFacadeService.currentModel$.pipe(d(this)).subscribe(e=>{if(O(e))return;this.models.find(o=>o.name===e)&&this.modelControl?.patchValue(e)})}subscribeToModelsListChanges(e){let t=!1;return this.modelsFacadeService.getModelsByType(e).pipe(P(o=>!qe(o)),F(o=>[...o].sort((a,j)=>Number(j.isTrained)-Number(a.isTrained)))).subscribe(o=>{this.models=o,this.searchModel.setValue(""),t||(this.listenToCurrentModelChanges(),t=!0)})}initializeForm(){this.parentFormGroup.addControl(this.controlKey,new L({[this.MODEL_CONTROL_NAME]:new $("",W.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(d(this)).subscribe(e=>{E(e)?this.modelFormGroup.disable():this.modelFormGroup.enable()})}listenToSearchModelValueChanges(){this.filteredModels=this.searchModel.valueChanges.pipe(d(this),Ne(""),F(e=>this.filterModels(e)))}filterModels(e){let t=e.toLowerCase();return this.models.filter(o=>o.name.toLowerCase().includes(t))}ngOnDestroy(){this.parentFormGroup.removeControl(this.controlKey)}},y.\u0275fac=function(t){return new(t||y)(s(h),s(V),s(D),s(et))},y.\u0275cmp=N({type:y,selectors:[["ms-panel-model-training"]],inputs:{controlKey:"controlKey",algorithmType:"algorithmType"},standalone:!0,features:[Z([],[{provide:h,useFactory:()=>H(h,{skipSelf:!0})}]),Ae,Re],decls:12,vars:5,consts:[[1,"ms-card","model-card"],[1,"panel-title-wrapper"],[1,"heading-sub-section-title"],[1,"form-field-container",3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","model","placeholder","Select a model..."],["label","Predefined Models"],[3,"formControl"],[3,"value"],["disabled",""],["fontSet","ms","fontIcon","icon-X",1,"mat-error"]],template:function(t,o){if(t&1&&(m(0,"mat-card",0)(1,"div",1)(2,"div",2),l(3,"Model"),r()(),m(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-optgroup",6)(8,"mat-option"),f(9,"ngx-mat-select-search",7),r(),C(10,Tt,3,1),A(11,"async"),r()()()()()),t&2){let a;n(4),c("formGroupName",o.controlKey),n(5),c("formControl",o.searchModel),n(),M((a=b(11,3,o.filteredModels))?10:-1,a)}},dependencies:[ie,X,k,$e,te,ee,le,K,re,oe,pe,se,J,Ve,ae,ne,q,ke,rt,ot,Ye],styles:[".panel-title-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px}.panel-title-wrapper[_ngcontent-%COMP%]   .train-models[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]}),y);U=S([I()],U);var Nt=(i,e)=>e.key;function At(i,e){if(i&1&&(m(0,"mat-option",6),l(1),r()),i&2){let t=e.$implicit;c("value",t.key),n(),u(" ",t.value," ")}}var _,fe=(_=class{get parentFormGroup(){return this.controlContainer.control}get algorithmTypeFormGroup(){return this.parentFormGroup.get(this.controlKey)}get algorithmTypeFormControl(){return this.algorithmTypeFormGroup.get(this.ALGORITHM_TYPE_CONTROL_NAME)}constructor(e,t){this.controlContainer=e,this.scriptFacadeService=t,this.controlKey="",this.algorithmTypesOptions=Je.filter(o=>o.key!==p.TRAIN&&o.key!==p.AWQ),this.ALGORITHM_TYPE_CONTROL_NAME="algorithmType"}ngOnInit(){this.initForm(),this.loadInitialData(),this.listenToScriptStateChanges()}loadInitialData(){this.scriptFacadeService.scriptDetails$.pipe(Q(1),Fe(1),P(e=>!O(e?.algKey)),F(e=>e.algKey)).subscribe(e=>{switch(e){case g.PRUNING_TRAIN:{this.algorithmTypeFormControl.patchValue(p.PRUNING);break}case g.MACHINE_UNLEARNING_TRAIN:{this.algorithmTypeFormControl.patchValue(p.MACHINE_UNLEARNING);break}case g.QUANTIZATION_TRAIN:{this.algorithmTypeFormControl.patchValue(p.QUANTIZATION);break}default:this.algorithmTypeFormControl.patchValue(p.PRUNING)}}),this.scriptFacadeService.dispatch(me.getCurrentOrLastActiveScriptDetails())}initForm(){this.parentFormGroup.addControl(this.controlKey,new L({[this.ALGORITHM_TYPE_CONTROL_NAME]:new $(p.PRUNING,W.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(d(this)).subscribe(e=>{E(e)?this.algorithmTypeFormGroup.disable():this.algorithmTypeFormGroup.enable()})}},_.\u0275fac=function(t){return new(t||_)(s(h),s(D))},_.\u0275cmp=N({type:_,selectors:[["ms-panel-algorithm-type-for-training"]],inputs:{controlKey:"controlKey"},features:[Z([],[{provide:h,useFactory:()=>H(h,{skipSelf:!0})}])],decls:9,vars:2,consts:[[1,"ms-card","parameters-card"],[1,"heading-sub-section-title"],[3,"formGroupName"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],[3,"formControlName"],[3,"value"]],template:function(t,o){t&1&&(m(0,"mat-card",0)(1,"p",1),l(2,"Algorithm Type"),r(),Pe(3,2),m(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5),x(7,At,2,2,"mat-option",6,Nt),r()()(),be(),r()),t&2&&(n(3),c("formGroupName",o.controlKey),n(3),c("formControlName",o.ALGORITHM_TYPE_CONTROL_NAME),n(),R(o.algorithmTypesOptions))},dependencies:[K,oe,se,J,X,k,te,ee]}),_);fe=S([I()],fe);function Pt(i,e){if(i&1&&(l(0),A(1,"adaptiveFileSize")),i&2){let t=w().$implicit;u(" ",b(1,1,t.value)," ")}}function bt(i,e){if(i&1&&(l(0),A(1,"date")),i&2){let t=w().$implicit;u(" ",we(1,1,t.value,"medium")," ")}}function Et(i,e){if(i&1&&(l(0),A(1,"readableDuration")),i&2){let t=w().$implicit;u(" ",b(1,1,t.value)," ")}}function Ot(i,e){if(i&1&&l(0),i&2){let t=w().$implicit;u(" ",t.value," ")}}function Gt(i,e){i&1&&(m(0,"div",8),f(1,"mat-divider"),r())}function xt(i,e){if(i&1&&(m(0,"div")(1,"div",5)(2,"div",6),l(3),A(4,"parametersLabel"),r(),m(5,"div",7),C(6,Pt,2,3)(7,bt,2,4)(8,Et,2,3)(9,Ot,1,1),r()(),C(10,Gt,2,0,"div",8),r()),i&2){let t,o=e.$implicit,a=e.$index,j=e.$count;n(3),u("",b(4,3,o.key),":"),n(3),M((t=o.key)==="file_size_bytes"?6:t==="creation_date"?7:t==="training_duration_seconds"?8:9),n(4),M(a!==j-1?10:-1)}}function Rt(i,e){if(i&1&&(m(0,"div",3),x(1,xt,11,5,"div",null,Ie),r()),i&2){let t=w();n(),R(t)}}function wt(i,e){i&1&&f(0,"ms-empty-state",4)}function kt(i,e){i&1&&(m(0,"div",2),C(1,Rt,3,0,"div",3)(2,wt,1,0,"ms-empty-state",4),r()),i&2&&(n(),M(e.length>0?1:2))}var v,ue=(v=class{constructor(e){this.modelsFacadeService=e,this.metadata={}}ngOnInit(){this.modelsFacadeService.modelMetadata$.pipe(Q(1),d(this)).subscribe(e=>{this.metadata=e})}},v.\u0275fac=function(t){return new(t||v)(s(V))},v.\u0275cmp=N({type:v,selectors:[["ms-panel-model-metadata"]],decls:5,vars:3,consts:[[1,"ms-card","metadata-card"],[1,"heading-sub-section-title"],[1,"metadata-wrapper"],[1,"key-value-container","single"],["title","No metadata available"],[1,"key-value-pair","space-between"],[1,"key-value-key"],[1,"key-value-value"],[1,"pt-2"]],template:function(t,o){if(t&1&&(m(0,"mat-card",0)(1,"p",1),l(2,"Model Training Information"),r(),C(3,kt,3,1,"div",2),A(4,"keyvalue"),r()),t&2){let a;n(3),M((a=b(4,1,o.metadata))?3:-1,a)}},dependencies:[nt,K,Ue,Le,De,at,lt,mt],styles:[".metadata-wrapper[_ngcontent-%COMP%]{max-height:300px;overflow:auto;padding-right:20px}"]}),v);ue=S([I()],ue);var Dt=["panelParameters"],T,he=(T=class{constructor(e,t,o,a){this.navigationService=e,this.scriptFacadeService=t,this.snackbarService=o,this.modelsFacadeService=a,this.form=new L({}),this.isScriptActive=!1,this.selectedAlgorithmType=p.PRUNING,this.selectedAlgorithmKey=g.PRUNING_TRAIN}ngOnInit(){this.listenToAlgorithmPanelChanges(),this.listenToScriptStateChanges(),this.listenToFormChangesToLoadModelMetadata()}listenToAlgorithmPanelChanges(){this.form.valueChanges.pipe(ge(50),F(()=>{let e=this.form.getRawValue();return e.algorithmTypeGroup&&e.algorithmTypeGroup.algorithmType}),Ce(),P(e=>!!e),d(this)).subscribe(e=>{this.selectedAlgorithmType=e,this.selectedAlgorithmKey=We[e]})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(d(this)).subscribe(e=>{this.isScriptActive=E(e),E(e)?this.form.disable():this.form.enable()})}listenToFormChangesToLoadModelMetadata(){this.form.valueChanges.pipe(ge(50),F(e=>{let t=e.algorithmTypeGroup?.algorithmType,o=e.model?.model;return{algorithmType:t,model:o}}),Ce((e,t)=>JSON.stringify(e)===JSON.stringify(t)),P(({algorithmType:e,model:t})=>!O(e)&&!O(t)),d(this)).subscribe(({algorithmType:e,model:t})=>{this.modelsFacadeService.dispatch(G.getModelMetadata({algorithmType:e,modelName:t}))})}submit(){if(Ze(this.selectedAlgorithmType)){this.snackbarService.showError("Select an algorithm before running a script.");return}let{model:e}=this.form.getRawValue(),{model:t}=e,o={alg:this.selectedAlgorithmKey,params:Se(Te({},this.panelParametersComponent.parametersFormatted),{arch:t})};this.scriptFacadeService.dispatch(me.callScript({configs:o}))}},T.\u0275fac=function(t){return new(t||T)(s(it),s(D),s(tt),s(V))},T.\u0275cmp=N({type:T,selectors:[["ms-model-training"]],viewQuery:function(t,o){if(t&1&&Oe(Dt,5),t&2){let a;Ge(a=xe())&&(o.panelParametersComponent=a.first)}},decls:17,vars:4,consts:[["panelParameters",""],[1,"heading-primary-title","title"],[1,"page-wrapper"],[1,"left",3,"formGroup"],["controlKey","algorithmTypeGroup"],["controlKey","model",3,"algorithmType"],["controlKey","params",3,"algorithm"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","primary",1,"ml-2",3,"click"],["fontSet","ms","fontIcon","icon-ArrowLeft"],[1,"right"]],template:function(t,o){if(t&1){let a=Ee();m(0,"p",1),l(1,"Model Training"),r(),m(2,"div",2)(3,"div",3),f(4,"ms-panel-algorithm-type-for-training",4)(5,"ms-panel-model-training",5)(6,"ms-panel-model-metadata")(7,"ms-panel-parameters",6,0),m(9,"div")(10,"button",7),_e("click",function(){return Me(a),ye(o.submit())}),l(11," Run "),r(),m(12,"button",8),_e("click",function(){return Me(a),ye(o.navigationService.goToPreviousPage())}),f(13,"mat-icon",9),l(14," Go back "),r()()(),m(15,"div",10),f(16,"ms-terminal"),r()()}t&2&&(n(3),c("formGroup",o.form),n(2),c("algorithmType",o.selectedAlgorithmType),n(2),c("algorithm",o.selectedAlgorithmKey),n(3),c("disabled",o.isScriptActive||o.form.invalid))},dependencies:[ce,U,de,k,Be,ne,ze,fe,ue],styles:[".title[_ngcontent-%COMP%]{margin-bottom:13px}"]}),T);he=S([I()],he);var Kt=[{path:"",component:he}],dt=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=Y({type:e}),e.\u0275inj=z({imports:[ve.forChild(Kt),ve]});let i=e;return i})();var _o=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=Y({type:e}),e.\u0275inj=z({imports:[q,dt,ce,U,de,le,je,pe,re,Qe,ie,ae,He]});let i=e;return i})();export{_o as ModelTrainingModule};
