import{a as Je,b as et,c as tt}from"./chunk-GBSIGIQF.js";import{a as Xe}from"./chunk-EQFLMJGI.js";import{a as le}from"./chunk-KRWNRKAQ.js";import{b as qe,c as We,d as R}from"./chunk-N4M3IRYG.js";import{a as ze,b as He}from"./chunk-X4G3WW7I.js";import{b as Ve}from"./chunk-EWCYLHFH.js";import"./chunk-AQXO3PTH.js";import"./chunk-K7FQHXIQ.js";import{a as ne,b as ae}from"./chunk-EL4FLL4A.js";import"./chunk-36MMDLJ6.js";import{a as ke,b as we}from"./chunk-OC2XOUQE.js";import{a as me}from"./chunk-A3TEKZZW.js";import{a as L,b as re}from"./chunk-OCTHNKRP.js";import"./chunk-DAEZKYSS.js";import"./chunk-OGR7OULT.js";import{a as D}from"./chunk-LS3MZLOQ.js";import{b as A,c as d,j as y,k as Qe}from"./chunk-OSQ72SWC.js";import"./chunk-ZTF7MLCF.js";import"./chunk-YRSJWEPX.js";import{b as $e,c as P,d as Be}from"./chunk-XX6ZYDLH.js";import"./chunk-4HSOKWHU.js";import"./chunk-47NJWMMS.js";import{a as oe,b as w,c as Ze,k as Ye}from"./chunk-7Q6ZV4YJ.js";import"./chunk-NCOEO6LZ.js";import{h as J,i as ee}from"./chunk-3DEWYFT2.js";import{$a as Se,$c as Oe,Aa as s,B as I,Cb as N,Db as b,Eb as Pe,Ec as u,F as pe,G as ye,I as ce,La as M,N as j,Na as f,O as Me,Pd as xe,Qd as H,Ta as v,Ua as _e,Ub as Re,Va as E,Vb as Ee,Wa as G,Wb as Ge,X as V,Xa as l,Xb as z,Ya as n,Za as h,Zd as Z,_ as $,_a as Te,_d as C,a as ge,ae as Y,b as Ce,bb as Ne,be as x,ca as T,ce as k,da as B,eb as ue,ee as U,gb as O,ie as Le,ja as ve,je as De,ka as de,ke as q,la as fe,lb as Fe,mb as Ie,me as W,nb as be,nc as he,pb as p,pe as Ue,qe as X,rb as g,re as Ke,sa as S,ue as je,v as _,wb as Q,we as te,xb as Ae,xe as ie,za as a}from"./chunk-ED6LLMLR.js";var ut=(i,t)=>t.name;function ht(i,t){i&1&&h(0,"mat-icon",10)}function gt(i,t){if(i&1&&(l(0,"mat-option",8),p(1),M(2,ht,1,0,"mat-icon",10),n()),i&2){let m=t.$implicit;f("value",m.name),a(),g(" ",m.name," "),a(),v(m.isTrained?-1:2)}}function Ct(i,t){i&1&&(l(0,"mat-option",9),p(1,"No results found"),n())}function yt(i,t){if(i&1&&(E(0,gt,3,3,"mat-option",8,ut),M(2,Ct,2,0,"mat-option",9)),i&2){let m=t;G(m),a(2),v(m.length===0?2:-1)}}var se=(()=>{let t=class t{ngOnChanges(e){e.algorithmType&&e.algorithmType.currentValue&&this.configureModels(e.algorithmType.currentValue)}get parentFormGroup(){return this.controlContainer.control}get modelFormGroup(){return this.parentFormGroup.get(this.controlKey)}get modelControl(){return this.modelFormGroup?.get(this.MODEL_CONTROL_NAME)}constructor(e,o,r,c,F){this.destroyRef=e,this.controlContainer=o,this.modelsFacadeService=r,this.scriptFacadeService=c,this.pageRunningScriptSpiningIndicatorService=F,this.controlKey="",this.PageKey=ze,this.RoutesList=Oe,this.searchModel=new U,this.models=[],this.MODEL_CONTROL_NAME="model"}ngOnInit(){this.initializeForm(),this.listenToScriptStateChanges(),this.listenToSearchModelValueChanges(),this.configureModels(this.algorithmType)}configureModels(e){if(e)switch(this.getModelsByTypeSubscription?.unsubscribe(),this.getModelsByTypeSubscription=this.subscribeToModelsListChanges(e),this.modelsFacadeService.dispatch(R.getModelsList({algorithmType:e})),e){case d.PRUNING:{this.modelsFacadeService.dispatch(R.getCurrentOrPreviousSelectedModel({algorithmType:y.PRUNING_TRAIN}));break}case d.QUANTIZATION:{this.modelsFacadeService.dispatch(R.getCurrentOrPreviousSelectedModel({algorithmType:y.QUANTIZATION_TRAIN}));break}case d.MACHINE_UNLEARNING:{this.modelsFacadeService.dispatch(R.getCurrentOrPreviousSelectedModel({algorithmType:y.MACHINE_UNLEARNING_TRAIN}));break}}}listenToCurrentModelChanges(){this.modelsFacadeService.currentModel$.pipe(u(this.destroyRef)).subscribe(e=>{if(P(e))return;this.models.find(r=>r.name===e)&&this.modelControl?.patchValue(e)})}subscribeToModelsListChanges(e){let o=!1;return this.modelsFacadeService.getModelsByType(e).pipe(I(r=>!Be(r)),_(r=>[...r].sort((c,F)=>Number(F.isTrained)-Number(c.isTrained)))).subscribe(r=>{this.models=r,this.searchModel.setValue(""),o||(this.listenToCurrentModelChanges(),o=!0)})}initializeForm(){this.parentFormGroup.addControl(this.controlKey,new k({[this.MODEL_CONTROL_NAME]:new U("",Z.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(u(this.destroyRef)).subscribe(e=>{A(e)?this.modelFormGroup.disable():this.modelFormGroup.enable()})}listenToSearchModelValueChanges(){this.filteredModels=this.searchModel.valueChanges.pipe(u(this.destroyRef),Me(""),_(e=>this.filterModels(e)))}filterModels(e){let o=e.toLowerCase();return this.models.filter(r=>r.name.toLowerCase().includes(o))}ngOnDestroy(){this.parentFormGroup.removeControl(this.controlKey)}};t.\u0275fac=function(o){return new(o||t)(s(S),s(C),s(D),s(w),s(He))},t.\u0275cmp=T({type:t,selectors:[["ms-panel-model-training"]],inputs:{controlKey:"controlKey",algorithmType:"algorithmType"},standalone:!0,features:[Q([],[{provide:C,useFactory:()=>$(C,{skipSelf:!0})}]),ve,Ae],decls:12,vars:5,consts:[[1,"ms-card","model-card"],[1,"panel-title-wrapper"],[1,"heading-sub-section-title"],[1,"form-field-container",3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","model","placeholder","Select a model..."],[3,"formControl"],["label","Predefined Models"],[3,"value"],["disabled",""],["fontSet","ms","fontIcon","icon-X",1,"mat-error"]],template:function(o,r){if(o&1&&(l(0,"mat-card",0)(1,"div",1)(2,"div",2),p(3,"Model"),n()(),l(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-option"),h(8,"ngx-mat-select-search",6),n(),l(9,"mat-optgroup",7),M(10,yt,3,1),N(11,"async"),n()()()()()),o&2){let c;a(4),f("formGroupName",r.controlKey),a(4),f("formControl",r.searchModel),a(2),v((c=b(11,3,r.filteredModels))?10:-1,c)}},dependencies:[X,Y,x,Le,W,q,re,L,ee,J,ae,ne,H,xe,ie,te,z,Re,We,qe,Ve],styles:[".panel-title-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px}.panel-title-wrapper[_ngcontent-%COMP%]   .train-models[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]});let i=t;return i})();var _t=(i,t)=>t.key;function Tt(i,t){if(i&1&&(l(0,"mat-option",6),p(1),n()),i&2){let m=t.$implicit;f("value",m.key),a(),g(" ",m.value," ")}}var nt=(()=>{let t=class t{get parentFormGroup(){return this.controlContainer.control}get algorithmTypeFormGroup(){return this.parentFormGroup.get(this.controlKey)}get algorithmTypeFormControl(){return this.algorithmTypeFormGroup.get(this.ALGORITHM_TYPE_CONTROL_NAME)}constructor(e,o,r){this.destroyRef=e,this.controlContainer=o,this.scriptFacadeService=r,this.controlKey="",this.algorithmTypesOptions=[{key:d.QUANTIZATION,value:"Quantization"},{key:d.PRUNING,value:"Pruning"},{key:d.MACHINE_UNLEARNING,value:"Machine Unlearning"}],this.ALGORITHM_TYPE_CONTROL_NAME="algorithmType"}ngOnInit(){this.initForm(),this.loadInitialData(),this.listenToScriptStateChanges()}loadInitialData(){this.scriptFacadeService.scriptDetails$.pipe(j(1),ye(1),I(e=>!P(e?.algKey)),_(e=>e.algKey)).subscribe(e=>{switch(e){case y.PRUNING_TRAIN:{this.algorithmTypeFormControl.patchValue(d.PRUNING);break}case y.MACHINE_UNLEARNING_TRAIN:{this.algorithmTypeFormControl.patchValue(d.MACHINE_UNLEARNING);break}case y.QUANTIZATION_TRAIN:{this.algorithmTypeFormControl.patchValue(d.QUANTIZATION);break}default:this.algorithmTypeFormControl.patchValue(d.PRUNING)}}),this.scriptFacadeService.dispatch(oe.getCurrentOrLastActiveScriptDetails())}initForm(){this.parentFormGroup.addControl(this.controlKey,new k({[this.ALGORITHM_TYPE_CONTROL_NAME]:new U(d.PRUNING,Z.required)}))}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(u(this.destroyRef)).subscribe(e=>{A(e)?this.algorithmTypeFormGroup.disable():this.algorithmTypeFormGroup.enable()})}};t.\u0275fac=function(o){return new(o||t)(s(S),s(C),s(w))},t.\u0275cmp=T({type:t,selectors:[["ms-panel-algorithm-type-for-training"]],inputs:{controlKey:"controlKey"},features:[Q([],[{provide:C,useFactory:()=>$(C,{skipSelf:!0})}])],decls:9,vars:2,consts:[[1,"ms-card","parameters-card"],[1,"heading-sub-section-title"],[3,"formGroupName"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],[3,"formControlName"],[3,"value"]],template:function(o,r){o&1&&(l(0,"mat-card",0)(1,"p",1),p(2,"Algorithm Type"),n(),Te(3,2),l(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5),E(7,Tt,2,2,"mat-option",6,_t),n()()(),Se(),n()),o&2&&(a(3),f("formGroupName",r.controlKey),a(3),f("formControlName",r.ALGORITHM_TYPE_CONTROL_NAME),a(),G(r.algorithmTypesOptions))},dependencies:[L,J,ne,H,Y,x,W,q]});let i=t;return i})();function Nt(i,t){if(i&1&&(p(0),N(1,"adaptiveFileSize")),i&2){let m=O().$implicit;g(" ",b(1,1,m.value)," ")}}function Ft(i,t){if(i&1&&(p(0),N(1,"date")),i&2){let m=O().$implicit;g(" ",Pe(1,1,m.value,"medium")," ")}}function It(i,t){if(i&1&&(p(0),N(1,"readableDuration")),i&2){let m=O().$implicit;g(" ",b(1,1,m.value)," ")}}function bt(i,t){if(i&1&&p(0),i&2){let m=O().$implicit;g(" ",m.value," ")}}function At(i,t){i&1&&(l(0,"div",8),h(1,"mat-divider"),n())}function Pt(i,t){if(i&1&&(l(0,"div")(1,"div",5)(2,"div",6),p(3),N(4,"parametersLabel"),n(),l(5,"div",7),M(6,Nt,2,3)(7,Ft,2,4)(8,It,2,3)(9,bt,1,1),n()(),M(10,At,2,0,"div",8),n()),i&2){let m,e=t.$implicit,o=t.$index,r=t.$count;a(3),g("",b(4,3,e.key),":"),a(3),v((m=e.key)==="file_size_bytes"?6:m==="creation_date"?7:m==="training_duration_seconds"?8:9),a(4),v(o!==r-1?10:-1)}}function Rt(i,t){if(i&1&&(l(0,"div",3),E(1,Pt,11,5,"div",null,_e),n()),i&2){let m=O();a(),G(m)}}function Et(i,t){i&1&&h(0,"ms-empty-state",4)}function Gt(i,t){i&1&&(l(0,"div",2),M(1,Rt,3,0,"div",3)(2,Et,1,0,"ms-empty-state",4),n()),i&2&&(a(),v(t.length>0?1:2))}var at=(()=>{let t=class t{constructor(e,o){this.destroyRef=e,this.modelsFacadeService=o,this.metadata={}}ngOnInit(){this.modelsFacadeService.modelMetadata$.pipe(j(1),u(this.destroyRef)).subscribe(e=>{this.metadata=e})}};t.\u0275fac=function(o){return new(o||t)(s(S),s(D))},t.\u0275cmp=T({type:t,selectors:[["ms-panel-model-metadata"]],decls:5,vars:3,consts:[[1,"ms-card","metadata-card"],[1,"heading-sub-section-title"],[1,"metadata-wrapper"],[1,"key-value-container","single"],["title","No metadata available"],[1,"key-value-pair","space-between"],[1,"key-value-key"],[1,"key-value-value"],[1,"pt-2"]],template:function(o,r){if(o&1&&(l(0,"mat-card",0)(1,"p",1),p(2,"Model Training Information"),n(),M(3,Gt,3,1,"div",2),N(4,"keyvalue"),n()),o&2){let c;a(3),v((c=b(4,1,r.metadata))?3:-1,c)}},dependencies:[Xe,L,ke,Ee,Ge,Je,tt,et],styles:[".metadata-wrapper[_ngcontent-%COMP%]{max-height:300px;overflow:auto;padding-right:20px}"]});let i=t;return i})();var xt=["panelParameters"],mt=(()=>{let t=class t{constructor(e,o,r,c,F){this.destroyRef=e,this.navigationService=o,this.scriptFacadeService=r,this.snackbarService=c,this.modelsFacadeService=F,this.form=new k({}),this.isScriptActive=!1,this.selectedAlgorithmType=d.PRUNING,this.selectedAlgorithmKey=y.PRUNING_TRAIN}ngOnInit(){this.listenToAlgorithmPanelChanges(),this.listenToScriptStateChanges(),this.listenToFormChangesToLoadModelMetadata()}listenToAlgorithmPanelChanges(){this.form.valueChanges.pipe(pe(50),_(()=>{let e=this.form.getRawValue();return e.algorithmTypeGroup&&e.algorithmTypeGroup.algorithmType}),ce(),I(e=>!!e),u(this.destroyRef)).subscribe(e=>{this.selectedAlgorithmType=e,this.selectedAlgorithmKey=Qe[e]})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe(u(this.destroyRef)).subscribe(e=>{this.isScriptActive=A(e),A(e)?this.form.disable():this.form.enable()})}listenToFormChangesToLoadModelMetadata(){this.form.valueChanges.pipe(pe(50),_(e=>{let o=e.algorithmTypeGroup?.algorithmType,r=e.model?.model;return{algorithmType:o,model:r}}),ce((e,o)=>JSON.stringify(e)===JSON.stringify(o)),I(({algorithmType:e,model:o})=>!P(e)&&!P(o)),u(this.destroyRef)).subscribe(({algorithmType:e,model:o})=>{this.modelsFacadeService.dispatch(R.getModelMetadata({algorithmType:e,modelName:o}))})}submit(){if($e(this.selectedAlgorithmType)){this.snackbarService.showError("Select an algorithm before running a script.");return}let{model:e}=this.form.getRawValue(),{model:o}=e,r={alg:this.selectedAlgorithmKey,params:Ce(ge({},this.panelParametersComponent.parametersFormatted),{arch:o})};this.scriptFacadeService.dispatch(oe.callScript({configs:r}))}};t.\u0275fac=function(o){return new(o||t)(s(S),s(Ye),s(w),s(Ze),s(D))},t.\u0275cmp=T({type:t,selectors:[["ms-model-training"]],viewQuery:function(o,r){if(o&1&&Fe(xt,5),o&2){let c;Ie(c=be())&&(r.panelParametersComponent=c.first)}},decls:17,vars:4,consts:[["panelParameters",""],[1,"heading-primary-title","title"],[1,"page-wrapper"],[1,"left",3,"formGroup"],["controlKey","algorithmTypeGroup"],["controlKey","model",3,"algorithmType"],["controlKey","params",3,"algorithm"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","primary",1,"ml-2",3,"click"],["fontSet","ms","fontIcon","icon-ArrowLeft"],[1,"right"]],template:function(o,r){if(o&1){let c=Ne();l(0,"p",1),p(1,"Model Training"),n(),l(2,"div",2)(3,"div",3),h(4,"ms-panel-algorithm-type-for-training",4)(5,"ms-panel-model-training",5)(6,"ms-panel-model-metadata")(7,"ms-panel-parameters",6,0),l(9,"div")(10,"button",7),ue("click",function(){return de(c),fe(r.submit())}),p(11," Run "),n(),l(12,"button",8),ue("click",function(){return de(c),fe(r.navigationService.goToPreviousPage())}),h(13,"mat-icon",9),p(14," Go back "),n()()(),l(15,"div",10),h(16,"ms-terminal-xterm-with-toolbar"),n()()}o&2&&(a(3),f("formGroup",r.form),a(2),f("algorithmType",r.selectedAlgorithmType),a(2),f("algorithm",r.selectedAlgorithmKey),a(3),f("disabled",r.isScriptActive||r.form.invalid))},dependencies:[me,se,le,x,De,te,Ke,nt,at],styles:[".title[_ngcontent-%COMP%]{margin-bottom:13px}"]});let i=t;return i})();var kt=[{path:"",component:mt}],lt=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=B({type:t}),t.\u0275inj=V({imports:[he.forChild(kt),he]});let i=t;return i})();var so=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=B({type:t}),t.\u0275inj=V({imports:[z,lt,me,se,le,re,we,ae,ee,Ue,X,ie,je]});let i=t;return i})();export{so as ModelTrainingModule};
