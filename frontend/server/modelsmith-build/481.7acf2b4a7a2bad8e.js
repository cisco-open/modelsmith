"use strict";(self.webpackChunkmodelsmith=self.webpackChunkmodelsmith||[]).push([[481],{8481:(Nt,R,n)=>{n.r(R),n.d(R,{ModelCompressionModule:()=>Pt});var d=n(6814),C=n(5154),c=n(4221),h=n(538);const D={models:(0,c.Lq)({models:[],error:void 0},(0,c.on)(h.l.loadModelsSuccess,(o,{models:e})=>({...o,models:[...e],error:void 0})),(0,c.on)(h.l.loadModelsFailure,(o,{error:e})=>({...o,error:e})))};var $=n(2096),b=n(2460),y=n(2181),V=n(4664),P=n(7398),K=n(6306),H=n(395),W=n(4992);class X extends W.eW{constructor(){super("model-files",void 0,void 0,!1)}}const k=(0,c.ZF)("model-compression"),J=(0,c.P1)(k,o=>o.models.models);var t=n(5879);let w=(()=>{var o;class e{constructor(s,r,m){this.apiClient=s,this.actions$=r,this.store=m,this.loadModels$=(0,C.GW)(()=>this.actions$.pipe((0,C.l4)(h.l.loadModels),(0,b.M)(this.store.select(J)),(0,y.h)(([u,F])=>!F||0===F.length),(0,V.w)(()=>this.apiClient.serviceCall(new X).pipe((0,P.U)(u=>h.l.loadModelsSuccess({models:u})),(0,K.K)(u=>(0,$.of)(h.l.loadModelsFailure({error:u})))))))}}return(o=e).\u0275fac=function(s){return new(s||o)(t.LFG(H.I),t.LFG(C.eX),t.LFG(c.yh))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),e})();var q=n(8524),M=n(1303),U=n(9547),N=n(7582),l=n(8791),_=n(3620),tt=n(3997),et=n(9386),E=n(4279);const v="custommodel";var S=n(7820),A=n(5360),Z=n(8471),a=n(6223),G=n(999),it=n(1146),nt=n(8450),st=n(6349),at=n(9534),lt=n(2296),rt=n(7921);let x=(()=>{var o;class e{constructor(s){this.store=s,this.models$=this.store.select(J)}dispatch(s){this.store.dispatch(s)}}return(o=e).\u0275fac=function(s){return new(s||o)(t.LFG(c.yh))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),e})();var p,ct=n(127),mt=n(6385),Y=n(5195),B=n(5683),j=n(8525),T=n(3680),dt=n(3427);function ht(o,e){if(1&o&&(t.TgZ(0,"mat-option",10),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.Q6J("value",i),t.xp6(1),t.hij(" ",i," ")}}function pt(o,e){1&o&&(t.TgZ(0,"mat-option",13),t._uU(1,"No results found"),t.qZA())}function gt(o,e){if(1&o&&(t.ynx(0),t.YNc(1,ht,2,2,"mat-option",11),t.YNc(2,pt,2,0,"mat-option",12),t.BQk()),2&o){const i=e.ngIf,s=t.oxw();t.xp6(1),t.Q6J("ngForOf",i)("ngForTrackBy",s.trackByModel),t.xp6(1),t.Q6J("ngIf",0===i.length)}}function ft(o,e){1&o&&(t.ynx(0),t._UZ(1,"ms-file-upload",14),t.BQk())}let Q=((p=class{get modelControl(){return this.form.get(this.MODEL_CONTROL_NAME)}constructor(e,i,s,r,m){this.fb=e,this.controlContainer=i,this.fileService=s,this.modelsFacadeService=r,this.scriptFacadeService=m,this.isCustomModelSelected=!1,this.searchModel=new a.NI,this.models=[],this.customModel=v,this.MODEL_CONTROL_NAME="model"}ngOnInit(){this.initializeForm(),this.loadModelsAndListenToChanges(),this.listenToModelChanges(),this.listenToScriptStateChanges(),this.filteredModels=this.searchModel.valueChanges.pipe((0,rt.O)(""),(0,P.U)(e=>this.filterModels(e)))}loadModelsAndListenToChanges(){this.modelsFacadeService.dispatch(h.l.loadModels()),this.modelsFacadeService.models$.pipe((0,l.t)(this)).subscribe(e=>{e?.length&&(this.models=e,this.searchModel.setValue(""))})}initializeForm(){this.form=this.fb.group({[this.MODEL_CONTROL_NAME]:new a.NI("",a.kI.required)}),this.controlContainer?.control?.parent?.setControl(this.controlContainer.name,this.form)}listenToModelChanges(){this.modelControl?.valueChanges.pipe((0,l.t)(this)).subscribe(e=>{e===v?(this.fileService.file=null,this.isCustomModelSelected=!0):this.isCustomModelSelected=!1})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe((0,l.t)(this)).subscribe(e=>{(0,A.A)(e)?this.form.disable():this.form.enable(),this.modelControl?.patchValue("resnet18")})}filterModels(e){const i=e.toLowerCase();return this.models.filter(s=>s.toLowerCase().includes(i))}trackByModel(e,i){return i}}).\u0275fac=function(e){return new(e||p)(t.Y36(a.qu),t.Y36(a.gN),t.Y36(G.I),t.Y36(x),t.Y36(Z.O))},p.\u0275cmp=t.Xpm({type:p,selectors:[["ms-panel-model"]],decls:17,vars:7,consts:[[1,"ms-card","model-card"],[1,"heading-sub-section-title"],[3,"formGroup"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","model","placeholder","Select a model..."],["label","Predefined Models"],[3,"formControl"],[4,"ngIf"],["label","Custom"],[3,"value"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["disabled","",4,"ngIf"],["disabled",""],[1,"mt-2"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0)(1,"p",1),t._uU(2,"Model"),t.qZA(),t.ynx(3,2),t.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-optgroup",6)(8,"mat-option"),t._UZ(9,"ngx-mat-select-search",7),t.qZA(),t.YNc(10,gt,3,3,"ng-container",8),t.ALo(11,"async"),t.qZA(),t._UZ(12,"mat-divider"),t.TgZ(13,"mat-optgroup",9)(14,"mat-option",10),t._uU(15,"Custom Model"),t.qZA()()()()(),t.BQk(),t.YNc(16,ft,2,0,"ng-container",8),t.qZA()),2&e&&(t.xp6(3),t.Q6J("formGroup",i.form),t.xp6(6),t.Q6J("formControl",i.searchModel),t.xp6(1),t.Q6J("ngIf",t.lcZ(11,5,i.filteredModels)),t.xp6(4),t.Q6J("value",i.customModel),t.xp6(2),t.Q6J("ngIf",i.isCustomModelSelected))},dependencies:[d.sg,d.O5,ct.J,mt.d,Y.a8,B.KE,j.gD,T.ey,T.Nv,a.JJ,a.JL,a.oH,a.sg,a.u,dt.nu,d.Ov],changeDetection:0}),p);Q=(0,N.gn)([(0,l.c)()],Q);var g,ut=n(836),vt=n(8180),Ct=n(39),O=n(8279);function Mt(o,e){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.Q6J("value",i.key),t.xp6(1),t.hij(" ",i.value," ")}}function St(o,e){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const i=e.$implicit;t.Q6J("value",i.key),t.xp6(1),t.hij(" ",i.value," ")}}let L=((g=class{get algorithmFormControl(){return this.form.get(this.ALGORITHM_CONTROL_NAME)}constructor(e,i,s){this.fb=e,this.controlContainer=i,this.scriptFacadeService=s,this.pruningAlgorithmsList=O.dD,this.quantAlgorithmsList=O.A3,this.ALGORITHM_CONTROL_NAME="alg"}ngOnInit(){this.initForm(),this.listenToScriptStateChanges(),this.loadInitialData()}loadInitialData(){this.scriptFacadeService.dispatch(Ct.aj.getCurrentOrLastActiveScriptDetails()),this.scriptFacadeService.scriptDetails$.pipe((0,ut.T)(1),(0,vt.q)(1),(0,y.h)(e=>!!e?.algKey)).subscribe(e=>{const i=e.type;this.setInitialAlgorithmValue(i===S.Bd.PRUNING||i===S.Bd.QUANTIZATION?e.algKey:O.k2)})}setInitialAlgorithmValue(e){this.algorithmFormControl?.setValue(e,{emitEvent:!0})}initForm(){this.form=this.fb.group({[this.ALGORITHM_CONTROL_NAME]:[O.k2,a.kI.required]}),this.controlContainer?.control?.parent?.setControl(this.controlContainer.name,this.form)}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe((0,l.t)(this)).subscribe(e=>{(0,A.A)(e)?this.form.disable():this.form.enable()})}trackByAlgorithmKey(e,i){return i.key}}).\u0275fac=function(e){return new(e||g)(t.Y36(a.qu),t.Y36(a.gN),t.Y36(Z.O))},g.\u0275cmp=t.Xpm({type:g,selectors:[["ms-panel-algorithm"]],decls:11,vars:6,consts:[[1,"ms-card","algorithm-card"],[1,"heading-sub-section-title"],[3,"formGroup"],[1,"form-field-container"],["appearance","outline","subscriptSizing","dynamic"],[3,"formControlName"],["label","Pruning"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["label","Quantization"],[3,"value"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0)(1,"p",1),t._uU(2,"Algorithm"),t.qZA(),t.ynx(3,2),t.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-select",5)(7,"mat-optgroup",6),t.YNc(8,Mt,2,2,"mat-option",7),t.qZA(),t.TgZ(9,"mat-optgroup",8),t.YNc(10,St,2,2,"mat-option",7),t.qZA()()()(),t.BQk(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("formGroup",i.form),t.xp6(3),t.Q6J("formControlName",i.ALGORITHM_CONTROL_NAME),t.xp6(2),t.Q6J("ngForOf",i.pruningAlgorithmsList)("ngForTrackBy",i.trackByAlgorithmKey),t.xp6(2),t.Q6J("ngForOf",i.quantAlgorithmsList)("ngForTrackBy",i.trackByAlgorithmKey))},dependencies:[d.sg,Y.a8,B.KE,j.gD,T.ey,T.Nv,a.JJ,a.JL,a.sg,a.u]}),g);var f;L=(0,N.gn)([(0,l.c)()],L);const At=["panelParameters"],Tt=["algorithmPanel"];function Ot(o,e){1&o&&(t.ynx(0),t._UZ(1,"ms-panel-model",12),t.BQk())}let I=((f=class{constructor(e,i,s,r,m,u,F){this.scriptFacadeService=e,this.fb=i,this.fileService=s,this.fileFacadeService=r,this.snackbarService=m,this.router=u,this.route=F,this.isScriptActive=!1,this.isQuantAlgorithmSelected=!1}ngOnInit(){this.initForm(),this.listenToScriptStateChanges(),this.listenToAlgorithmPanelChanges()}listenToAlgorithmPanelChanges(){this.form.valueChanges.pipe((0,_.b)(50),(0,P.U)(e=>e.algorithm&&e.algorithm.alg),(0,tt.x)(),(0,y.h)(e=>!!e),(0,l.t)(this)).subscribe(e=>{this.isQuantAlgorithmSelected=(0,S.t6)(e)===S.Bd.QUANTIZATION})}listenToScriptStateChanges(){this.scriptFacadeService.scriptStatus$.pipe((0,l.t)(this)).subscribe(e=>{this.isScriptActive=(0,A.A)(e),(0,A.A)(e)?this.form.disable():this.form.enable()})}initForm(){this.form=this.fb.group({algorithm:[],model:[],params:[]})}submit(){this.isQuantAlgorithmSelected?this.handleQuantizationCase():this.handlePruningCase()}handleQuantizationCase(){const{algorithm:e,model:i}=this.form.getRawValue(),{model:s}=i;if(s===v&&!this.fileService.isFileLoaded)return void this.snackbarService.showError("Please select a predefined model or upload a custom file.");let r=s===v?function ot(o){let e=o.replace(/[^a-zA-Z0-9_]/g,"_");return/^[0-9_]/.test(e)&&(e="file_"+e),/.py$/.test(e)||(e+=".py"),e}(this.fileService?.file.name):s;const m={...e,params:{...this.panelParametersComponent.parametersFormatted,arch:r}};s===v?this.fileFacadeService.dispatch(et._.uploadFileAndCallScript({file:this.fileService.file,configs:m})):this.scriptFacadeService.dispatch(E.a.callScript({configs:m}))}handlePruningCase(){const{algorithm:e}=this.form.getRawValue(),i={...e,params:this.panelParametersComponent.parametersFormatted};this.scriptFacadeService.dispatch(E.a.callScript({configs:i}))}goToChartPage(){this.router.navigate([U.Z.MODEL_COMPRESSION.RUNNING.ROOT],{relativeTo:this.route.parent})}}).\u0275fac=function(e){return new(e||f)(t.Y36(Z.O),t.Y36(a.qu),t.Y36(G.I),t.Y36(it.h),t.Y36(nt.QD),t.Y36(M.F0),t.Y36(M.gz))},f.\u0275cmp=t.Xpm({type:f,selectors:[["ms-machine-unlearning"]],viewQuery:function(e,i){if(1&e&&(t.Gf(At,5),t.Gf(Tt,5)),2&e){let s;t.iGM(s=t.CRH())&&(i.panelParametersComponent=s.first),t.iGM(s=t.CRH())&&(i.algorithmParametersComponent=s.first)}},decls:17,vars:4,consts:[[1,"heading-primary-title","title"],[1,"project-settings-wrapper",3,"formGroup"],[1,"left"],[3,"formGroup"],["formGroupName","algorithm"],["panelAlgorithm",""],[4,"ngIf"],["formArrayName","params"],["panelParameters",""],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-raised-button","","color","primary",1,"ml-2",3,"click"],[1,"right"],["formGroupName","model"]],template:function(e,i){1&e&&(t.TgZ(0,"p",0),t._uU(1,"Project Settings"),t.qZA(),t.TgZ(2,"div",1)(3,"div",2),t.ynx(4,3),t._UZ(5,"ms-panel-algorithm",4,5),t.YNc(7,Ot,2,0,"ng-container",6),t._UZ(8,"ms-panel-parameters",7,8),t.BQk(),t.TgZ(10,"div")(11,"button",9),t.NdJ("click",function(){return i.submit()}),t._uU(12," Run "),t.qZA(),t.TgZ(13,"button",10),t.NdJ("click",function(){return i.goToChartPage()}),t._uU(14,"View Chart"),t.qZA()()(),t.TgZ(15,"div",11),t._UZ(16,"ms-terminal"),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(3),t.Q6J("ngIf",i.isQuantAlgorithmSelected),t.xp6(4),t.Q6J("disabled",i.isScriptActive||i.form.invalid))},dependencies:[d.O5,st.d,at.w,lt.lW,a.JL,a.sg,a.x0,a.CE,Q,L],styles:[".title[_ngcontent-%COMP%]{margin-bottom:13px}.project-settings-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px;height:100%}.project-settings-wrapper[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:45%;gap:20px}.project-settings-wrapper[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:55%}"]}),f);I=(0,N.gn)([(0,l.c)()],I);const Ft=[{path:"",component:I},{path:U.Z.MODEL_COMPRESSION.RUNNING.ROOT,loadChildren:()=>n.e(466).then(n.bind(n,8466)).then(o=>o.RunningModule)}];let yt=(()=>{var o;class e{}return(o=e).\u0275fac=function(s){return new(s||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[M.Bz.forChild(Ft),M.Bz]}),e})(),Pt=(()=>{var o;class e{}return(o=e).\u0275fac=function(s){return new(s||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[x],imports:[d.ez,q.m,yt,c.Aw.forFeature("model-compression",D),C.sQ.forFeature([w])]}),e})()}}]);